<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Ansitheus | kiennt26's home</title><link rel=apple-touch-icon sizes=57x57 href=/favicon_io/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon_io/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon_io/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon_io/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon_io/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon_io/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon_io/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon_io/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon_io/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon_io/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon_io/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon_io/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon_io/favicon-16x16.png><link rel=manifest href=/favicon_io/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/favicon_io/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/css/main.min.76bc86cdef49db39afe56fee5088207afbb36c689fa25ca7587da7ec84686ca0.css integrity="sha256-dryGze9J2zmv5W/uUIggevuzbGifolynWH2n7IRobKA=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script></head><body><header><header><nav class=path-nav><ol><li>/
<a href=/>kiennt26's home</a>
/</li><li><a href=/posts/>Posts</a>
/</li><li class=current><a href=/posts/ansitheus/>Ansitheus</a></li></ol></nav></header></header><main><h1>Ansitheus</h1><div class=terms-list><ul><li><a href=/tags/tech/>[Tech]</a></li><li><a href=/tags/ansible/>[Ansible]</a></li><li><a href=/tags/prometheus/>[Prometheus]</a></li></ul></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Ansitheus: Ansible + Prometheus
</span></span></code></pre></div><h2 id=prometheus-overview>Prometheus overview</h2><blockquote><p><strong>NOTE</strong>: Checkout the <a href=https://prometheus.io/docs/introduction/overview/>Prometheus official documentation</a>.</p></blockquote><p><a href=https://github.com/prometheus>Prometheus</a> is an open-source systems monitoring & alerting toolkit originally built at SoundCloud.</p><h3 id=features>Features</h3><ul><li>a multi-dimensional data model with time series data identified by metric name & key/value pairs</li><li>PromQL, a flexible query language to leverage this dimensionality</li><li>no reliance on distributed storage; single server nodes are autonomous</li><li>time series collection happens via a pull model over HTTP</li><li>pushing time series is supported via an intermediary gateway</li><li>targets are discovered via service discovery or static configuration</li><li>multiple modes of graphing & dashboarding support</li></ul><h3 id=architecture--components>Architecture & components</h3><p>Prometheus scrapes metrics from instrumented jobs, either directly or via an intermediary push gateway for short-lived jobs. It stores all scraped samples locally & runs rules over this data to either aggregate & record new time series from existing data or generate alerts. Grafana or other API consumers can be used to visualize the collected data.</p><p><img src=https://prometheus.io/assets/architecture.png alt></p><ul><li>Prometheus server: scrapes & stores time series data.</li><li>Prometheus alertmanager: handle alerts.</li><li>Special-purpose exporters.</li><li>Push-gateway: support short-lived jobs.</li><li>client libraries: instrument application code.</li><li>Various support tools: Grafana,&mldr;</li></ul><h2 id=ansitheus>Ansitheus</h2><h3 id=why-ansitheus>Why Ansitheus?</h3><p>As you can see that, Prometheus ecosystem consists of multiple components. The operator may need a lot of efforts to configure, deploy & maintain these components. To make life easier, it is necessary to enter the world of automation, using modern tools of configuration management, provisioning & orchestration. <a href=https://ansible.com>Ansible</a> is one of them. It is <a href=https://www.ansible.com/overview/how-ansible-works>simple, agentless IT automation that anyone can use</a>. My team decided to choose it as the automation solution, & <a href=https://github.com/ntk148v/ansitheus>Ansitheus</a> is the result.</p><h3 id=features-1>Features</h3><p>The idea using Ansible to deploy Prometheus is not new. There are many existing solutions:</p><ul><li><a href=https://github.com/cloudalchemy/ansible-prometheus>cloudalchemy/ansible-prometheus</a></li><li><a href=https://github.com/ernestas-poskus/ansible-prometheus>ernestas-poskus/ansible-prometheus</a></li><li>&mldr;</li></ul><p>So what makes <code>Ansitheus</code> be different with others?</p><ul><li><strong>Deploy, configure & maintain the Prometheus ecosystem easily</strong>.</li><li><strong>Allow users to configure, deploy the system from scratch</strong>:<ul><li>Prepare, configure the local repository.</li><li>Install the necessary packages.</li><li>Configure Docker private registry.</li><li>Configure Docker daemon.</li></ul></li><li><strong>Containerize Prometheus components</strong>:<ul><li><a href=https://docker.com>Docker</a> is hotter than hot because it makes it possible to get far more apps running on the same old servers & it also makes it very easy to package & ship programs.</li><li>You can easily find the advantages of Docker & container through internet.</li></ul></li><li><strong>High availability</strong> with HAProxy & Keepalived.</li><li><strong>Support centralized Docker logging</strong> with Fluentd.</li><li><strong>Support Ansible vault</strong> to work with sensitive data.</li></ul><h3 id=components>Components</h3><ul><li><a href=https://github.com/prometheus/prometheus>Prometheus Server</a></li><li><a href=https://github.com/prometheus/alertmanager>Prometheus Alertmanager</a></li><li><a href=https://github.com/prometheus/node_exporter>Prometheus Node-exporter</a></li><li><a href=https://github.com/google/cadvisor>Google Cadvisor</a></li><li><a href=https://github.com/prometheus/snmp_exporter>Prometheus SNMP exporter</a></li><li><a href=http://www.haproxy.org/>Haproxy</a></li><li><a href=https://www.keepalived.org/>Keepalived</a></li><li><a href=https://github.com/fluent/fluentd>Fluentd</a></li><li><a href=https://github.com/grafana/grafana>Grafana</a></li><li>Other Prometheus exporters - <strong>TODO</strong></li></ul><h3 id=getting-started>Getting started</h3><ol><li><p>Install Ansible in deployment node.</p></li><li><p>Clone this repostiory.</p></li><li><p>Create configuration directory, default path <code>/etc/ansitheus</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mkdir -p /etc/ansitheus
</span></span><span class=line><span class=cl>sudo chown <span class=nv>$USER</span>:<span class=nv>$USER</span> /etc/ansitheus
</span></span></code></pre></div></li><li><p>Copy <code>config.yml</code> to <code>/etc/ansitheus</code> directory - this is the main configuration for Ansible monitoring tool.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp /path/to/ansitheus/repository/etc/ansitheus/config.yml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    /etc/ansitheus/config.yml
</span></span></code></pre></div></li><li><p>Copy inventory files to the current directory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp /path/to/ansitheus/repository/ansible/inventory/* .
</span></span></code></pre></div></li><li><p>Modify inventory & <code>/etc/ansitheus/config.yml</code>.</p></li><li><p>Run <a href=./tools/ansitheus>tools/ansitheus</a>, figure out yourself:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Usage: ./tools/ansitheus COMMAND <span class=o>[</span>option<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Options:
</span></span><span class=line><span class=cl>    --inventory, -i &lt;inventory_path&gt; Specify path to ansible inventory file
</span></span><span class=line><span class=cl>    --configdir, -c &lt;config_path&gt;    Specify path to directory with config.yml
</span></span><span class=line><span class=cl>    --verbose, -v                    Increase verbosity of ansible-playbook
</span></span><span class=line><span class=cl>    --tags, -t &lt;tags&gt;                Only run plays <span class=p>&amp;</span> tasks tagged with these values
</span></span><span class=line><span class=cl>    --help, -h                       Show this usage information
</span></span><span class=line><span class=cl>    --skip-common                    Skip common role
</span></span><span class=line><span class=cl>    --ask-vault-pass                 Ask <span class=k>for</span> vault password
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Commands:
</span></span><span class=line><span class=cl>    precheck                         Do pre-deployment checks <span class=k>for</span> hosts
</span></span><span class=line><span class=cl>    deploy                           Deploy <span class=p>&amp;</span> start all ansitheus containers
</span></span><span class=line><span class=cl>    pull                             Pull all images <span class=k>for</span> containers <span class=o>(</span>only pull, no running containers<span class=o>)</span>
</span></span><span class=line><span class=cl>    destroy                          Destroy Prometheus containers <span class=p>&amp;</span> service configuration
</span></span><span class=line><span class=cl>                                        --include-images to also destroy Prometheus images
</span></span><span class=line><span class=cl>                                        --include-volumes to also destroy Prometheus volumes
</span></span></code></pre></div></li></ol><h3 id=contributors>Contributors</h3><ol><li><a href=https://github.com/ntk148v>Kien Nguyen</a></li><li><a href=https://github.com/vtdat>Dat Vu</a></li><li><a href=https://github.com/vanduc95>Duc Nguyen</a></li><li><a href=https://github.com/LongCaoBK>Long Cao</a></li></ol><time datetime=2020-05-05>2020-05-05&nbsp;</time><div class=terminal-nav><div class=back-nav><a href=../ class=back-link>../</a></div></div></main><footer><p>&copy; Copyright 2025 &#183;
<a href=https://github.com/ntk148v/shibui>shibui</a></p></footer></body></html>