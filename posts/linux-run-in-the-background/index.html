<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Linux Run in the Background | kiennt26's home</title><link rel=apple-touch-icon sizes=57x57 href=/favicon_io/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon_io/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon_io/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon_io/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon_io/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon_io/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon_io/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon_io/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon_io/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon_io/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon_io/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon_io/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon_io/favicon-16x16.png><link rel=manifest href=/favicon_io/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/favicon_io/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/css/main.min.38925bdd47aabb0eb892bbce566836b59b62905bd8a5aec203df13887e0ef16f.css integrity="sha256-OJJb3Uequw64krvOVmg2tZtikFvYpa7CA98TiH4O8W8=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script></head><body><header><header><nav class=path-nav><ol><li>/
<a href=/>kiennt26's home</a>
/</li><li><a href=/posts/>Posts</a>
/</li><li class=current><a href=/posts/linux-run-in-the-background/>Linux Run in the Background</a></li></ol></nav></header></header><main><h1>Linux Run in the Background</h1><div class=terms-list><ul><li><a href=/tags/tech/>#Tech</a></li><li><a href=/tags/linux/>#Linux</a></li></ul></div><nav class=toc><strong>Table of contents</strong><div class=toc-content><nav id=TableOfContents><ol><li><a href=#ctrl-z-or->Ctrl-Z or &</a></li><li><a href=#screen>screen</a></li><li><a href=#nohup>nohup</a></li><li><a href=#supervisor>supervisor</a></li><li><a href=#systemd>systemd</a></li></ol></nav></div></nav><blockquote><p><strong>Environment:</strong> Ubuntu 22.04, but it should work in other Linux distributions.</p><p><strong>Source</strong>: <a href=https://www.sobyte.net/post/2023-03/linux-services-in-the-background/>https://www.sobyte.net/post/2023-03/linux-services-in-the-background/</a></p></blockquote><p>You run some commands, it may take a long time to execute, and you don&rsquo;t want to wait for it. So what should you do in that scenario?</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>graph TD
</span></span><span style=display:flex><span>A(You don&#39;t want to wait &lt;br&gt;for a running command) --&gt; B{Do you want to see output?}
</span></span><span style=display:flex><span>A --&gt; C{Do you want the command to stay &lt;br&gt;running after the session ends?}
</span></span><span style=display:flex><span>C --&gt; |Yes| E(screen)
</span></span><span style=display:flex><span>B --&gt; |No| D(Ctrl-Z or &amp;)
</span></span><span style=display:flex><span>B --&gt; |Yes| F{Do you have requirements &lt;br&gt;for log cutting, running users?}
</span></span><span style=display:flex><span>F --&gt; |No| G(nohup)
</span></span><span style=display:flex><span>F --&gt; |Yes| H(supervisor or systemd)
</span></span></code></pre></div><h2 id=ctrl-z-or->Ctrl-Z or &</h2><p>For example, you have to excute <code>ping</code> command:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ping -c 20 8.8.8.8
</span></span></code></pre></div><p>You want to send it to background, you can do the following:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ping -c 20 8.8.8.8 &amp;
</span></span><span style=display:flex><span>[1] 467176
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># Or hit ctrl-z, the effect of the &amp; symbol is similar to ctrl-z</span>
</span></span><span style=display:flex><span>$ ping -c 20 8.8.8.8 <span style=color:#888;font-style:italic># Press ctrl+z to hang</span>
</span></span><span style=display:flex><span>^Z[1]  + 467680 suspended
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># View the hung background processes</span>
</span></span><span style=display:flex><span>$ job -l
</span></span><span style=display:flex><span>[1]  + 467680 suspended
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># Bring the background task process back up and see that process is executing again</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># fg %&lt;number&gt;</span>
</span></span><span style=display:flex><span>$ <span style=font-weight:700;font-style:italic>fg</span> %1
</span></span></code></pre></div><h2 id=screen>screen</h2><p>If you want the program to continue running after the session ends, consider using <code>screen</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sudo apt install screen
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># man screen</span>
</span></span><span style=display:flex><span>$ man screen
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SCREEN(1)                                                                   General Commands Manual                                                                   SCREEN(1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME
</span></span><span style=display:flex><span>       screen - screen manager with VT100/ANSI terminal emulation
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SYNOPSIS
</span></span><span style=display:flex><span>       screen [ -options ] [ cmd [ args ] ]
</span></span><span style=display:flex><span>       screen -r [[pid.]tty[.host]]
</span></span><span style=display:flex><span>       screen -r sessionowner/[[pid.]tty[.host]]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># Create a ping session</span>
</span></span><span style=display:flex><span>$ screen -R &lt;session-name&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># Exit the session, recreate another one and use the previous command</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># you can see that the command is still running</span>
</span></span><span style=display:flex><span>$ screen -R &lt;session-name&gt;
</span></span></code></pre></div><h2 id=nohup>nohup</h2><p><code>screen</code> is more suitable for executing some scripts than <code>nohup</code>, while <code>nohup</code> is suitable for running a long-time tasks.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ nohup <span style=font-weight:700;font-style:italic>command</span> &gt; command.log 2&gt;&amp;1 &amp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># There are 3 types of input and output defined in Linux:</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 0: standard input</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 1: standard output</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 2: error output</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 2&gt;&amp;1: the error output 2 is redirected to the standard output &amp;1</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># combined with &gt; to be output to the file log.</span>
</span></span></code></pre></div><h2 id=supervisor>supervisor</h2><p><code>nohup</code> is still very good for performing simple background tasks, but if you have requirements for output log cutting, running users,&mldr; you need to consider daemon type programs such as <code>supervisor</code> and <code>systemd</code>.</p><p><code>supervisor</code> is a lightweight process control system, used to run programs for long period of time, often used for web background programs, proxy programs, etc.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo apt install supervisor
</span></span><span style=display:flex><span>$ sudo systemctl <span style=font-weight:700;font-style:italic>enable</span> supervisor
</span></span><span style=display:flex><span>$ sudo systemctl start supervisor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># Create supervisor file</span>
</span></span><span style=display:flex><span>$ sudo cat <span style=color:#666;font-style:italic>&lt;&lt;EOF &gt;/etc/supervisor/conf.d/sync.conf
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>[program:syncthing]
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>directory=/home/apps/syncthing/syncthing-linux-amd64-v1.19.0
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>command=/home/apps/syncthing/syncthing-linux-amd64-v1.19.0/syncthing
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>autostart=true
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>autorestart=true
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>startsecs=10
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>stdout_logfile=/var/log/supervisor/%(program_name)s-stdout.log
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>stdout_logfile_maxbytes=5MB
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>stdout_capture_maxbytes=5MB
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>stdout_logfile_backups=5
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>stderr_logfile=/var/log/supervisor/%(program_name)s-stderr.log
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>stderr_logfile_maxbytes=5MB
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>stderr_capture_maxbytes=5MB
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>stderr_logfile_backups=5
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>user = apps
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>environment = HOME=&#34;/home/apps/syncthing/syncthing-linux-amd64-v1.19.0&#34;
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># Make the newly created service effective</span>
</span></span><span style=display:flex><span>$ sudo supervisorctl update
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># update: means update the list of services and re-run the new/modified services</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># status: check the running status of all services</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># start/stop/restart: start/stop/restart the service</span>
</span></span></code></pre></div><h2 id=systemd>systemd</h2><p><code>systemd</code> is the system suite that comes with the most distributions to replace <code>SysV init</code>, providing reliable parallelism during the boot process and centralized management of processes, daemons, services and mount points. It is a relatively heavyweight system, and unless there is a clear need to use it, it is generally not considered a way to run small applications (or commands) in the background.</p><p><code>systemd</code> common user unit configuration directory:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>$HOME</span>/.config/systemd/user
</span></span><span style=display:flex><span>/usr/lib/systemd/user
</span></span><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>$HOME</span>/.local/share/systemd/user
</span></span><span style=display:flex><span>/etc/systemd/user
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#888;font-style:italic># Create file</span>
</span></span><span style=display:flex><span>$ cat <span style=color:#666;font-style:italic>&lt;&lt;EOF &gt;$HOME/.config/systemd/user/sync.service
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>[Unit]
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>Description=Sync Files
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>Documentation=https://syncthing.net
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>After=network.target
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>[Service]
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>Type=simple
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>Environment=HOME=&#34;/home/apps/syncthing/syncthing-linux-amd64-v1.19.0&#34;
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>ExecStart=/home/apps/syncthing/syncthing-linux-amd64-v1.19.0/syncthing
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic># Logging requires systemd version &gt; 240
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>StandardOutput=append:/home/apps/syncthing/syncthing-linux-amd64-v1.19.0/logs/standard-output.log
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>StandardError=append:/home/apps/syncthing/syncthing-linux-amd64-v1.19.0/logs/standard-error.log
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>[Install]
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>WantedBy=multi-user.target
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ systemctl start sync --user
</span></span></code></pre></div><time datetime=2023-03-03>2023-03-03&nbsp;</time><div class=terminal-nav><div class=back-nav><a href=../ class=back-link>../</a></div></div></main><footer><p>&copy; Copyright 2025 &#183;
<a href=https://github.com/ntk148v/shibui>shibui</a></p></footer></body></html>