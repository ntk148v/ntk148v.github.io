<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Linux Run in the Background | kiennt26's home</title><link rel=apple-touch-icon sizes=57x57 href=/favicon_io/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon_io/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon_io/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon_io/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon_io/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon_io/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon_io/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon_io/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon_io/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon_io/android-icon-192x192.png><link rel=icon type=image/png sizes=32x32 href=/favicon_io/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon_io/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon_io/favicon-16x16.png><link rel=manifest href=/favicon_io/manifest.json><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/favicon_io/ms-icon-144x144.png"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=/css/main.min.7bdbfbafb8333145a35ebf0f83cf7868a227a36e4ce6e4286433fa925c0b3835.css integrity="sha256-e9v7r7gzMUWjXr8Pg894aKIno25M5uQoZDP6klwLODU=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script></head><body><header><header><nav class=path-nav><ol><li>/
<a href=/>kiennt26's home</a>
/</li><li><a href=/posts/>Posts</a>
/</li><li class=current><a href=/posts/linux-run-in-the-background/>Linux Run in the Background</a></li></ol></nav></header></header><main><h1>Linux Run in the Background</h1><div class=terms-list><ul><li><a href=/tags/tech/>[Tech]</a></li><li><a href=/tags/linux/>[Linux]</a></li></ul></div><blockquote><p><strong>Environment:</strong> Ubuntu 22.04, but it should work in other Linux distributions.</p><p><strong>Source</strong>: <a href=https://www.sobyte.net/post/2023-03/linux-services-in-the-background/>https://www.sobyte.net/post/2023-03/linux-services-in-the-background/</a></p></blockquote><p>You run some commands, it may take a long time to execute, and you don&rsquo;t want to wait for it. So what should you do in that scenario?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>graph TD
</span></span><span class=line><span class=cl>A(You don&#39;t want to wait &lt;br&gt;for a running command) --&gt; B{Do you want to see output?}
</span></span><span class=line><span class=cl>A --&gt; C{Do you want the command to stay &lt;br&gt;running after the session ends?}
</span></span><span class=line><span class=cl>C --&gt; |Yes| E(screen)
</span></span><span class=line><span class=cl>B --&gt; |No| D(Ctrl-Z or &amp;)
</span></span><span class=line><span class=cl>B --&gt; |Yes| F{Do you have requirements &lt;br&gt;for log cutting, running users?}
</span></span><span class=line><span class=cl>F --&gt; |No| G(nohup)
</span></span><span class=line><span class=cl>F --&gt; |Yes| H(supervisor or systemd)
</span></span></code></pre></div><h2 id=ctrl-z-or->Ctrl-Z or &</h2><p>For example, you have to excute <code>ping</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ping -c <span class=m>20</span> 8.8.8.8
</span></span></code></pre></div><p>You want to send it to background, you can do the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ping -c <span class=m>20</span> 8.8.8.8 <span class=p>&amp;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>1<span class=o>]</span> <span class=m>467176</span>
</span></span><span class=line><span class=cl><span class=c1># Or hit ctrl-z, the effect of the &amp; symbol is similar to ctrl-z</span>
</span></span><span class=line><span class=cl>$ ping -c <span class=m>20</span> 8.8.8.8 <span class=c1># Press ctrl+z to hang</span>
</span></span><span class=line><span class=cl>^Z<span class=o>[</span>1<span class=o>]</span>  + <span class=m>467680</span> suspended
</span></span><span class=line><span class=cl><span class=c1># View the hung background processes</span>
</span></span><span class=line><span class=cl>$ job -l
</span></span><span class=line><span class=cl><span class=o>[</span>1<span class=o>]</span>  + <span class=m>467680</span> suspended
</span></span><span class=line><span class=cl><span class=c1># Bring the background task process back up and see that process is executing again</span>
</span></span><span class=line><span class=cl><span class=c1># fg %&lt;number&gt;</span>
</span></span><span class=line><span class=cl>$ <span class=nb>fg</span> %1
</span></span></code></pre></div><h2 id=screen>screen</h2><p>If you want the program to continue running after the session ends, consider using <code>screen</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ sudo apt install screen
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># man screen</span>
</span></span><span class=line><span class=cl>$ man screen
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>SCREEN<span class=o>(</span>1<span class=o>)</span>                                                                   General Commands Manual                                                                   SCREEN<span class=o>(</span>1<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME
</span></span><span class=line><span class=cl>       screen - screen manager with VT100/ANSI terminal emulation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>SYNOPSIS
</span></span><span class=line><span class=cl>       screen <span class=o>[</span> -options <span class=o>]</span> <span class=o>[</span> cmd <span class=o>[</span> args <span class=o>]</span> <span class=o>]</span>
</span></span><span class=line><span class=cl>       screen -r <span class=o>[[</span>pid.<span class=o>]</span>tty<span class=o>[</span>.host<span class=o>]]</span>
</span></span><span class=line><span class=cl>       screen -r sessionowner/<span class=o>[[</span>pid.<span class=o>]</span>tty<span class=o>[</span>.host<span class=o>]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=c1># Create a ping session</span>
</span></span><span class=line><span class=cl>$ screen -R &lt;session-name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Exit the session, recreate another one and use the previous command</span>
</span></span><span class=line><span class=cl><span class=c1># you can see that the command is still running</span>
</span></span><span class=line><span class=cl>$ screen -R &lt;session-name&gt;
</span></span></code></pre></div><h2 id=nohup>nohup</h2><p><code>screen</code> is more suitable for executing some scripts than <code>nohup</code>, while <code>nohup</code> is suitable for running a long-time tasks.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ nohup <span class=nb>command</span> &gt; command.log 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># There are 3 types of input and output defined in Linux:</span>
</span></span><span class=line><span class=cl><span class=c1># 0: standard input</span>
</span></span><span class=line><span class=cl><span class=c1># 1: standard output</span>
</span></span><span class=line><span class=cl><span class=c1># 2: error output</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># 2&gt;&amp;1: the error output 2 is redirected to the standard output &amp;1</span>
</span></span><span class=line><span class=cl><span class=c1># combined with &gt; to be output to the file log.</span>
</span></span></code></pre></div><h2 id=supervisor>supervisor</h2><p><code>nohup</code> is still very good for performing simple background tasks, but if you have requirements for output log cutting, running users,&mldr; you need to consider daemon type programs such as <code>supervisor</code> and <code>systemd</code>.</p><p><code>supervisor</code> is a lightweight process control system, used to run programs for long period of time, often used for web background programs, proxy programs, etc.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ sudo apt install supervisor
</span></span><span class=line><span class=cl>$ sudo systemctl <span class=nb>enable</span> supervisor
</span></span><span class=line><span class=cl>$ sudo systemctl start supervisor
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create supervisor file</span>
</span></span><span class=line><span class=cl>$ sudo cat <span class=s>&lt;&lt;EOF &gt;/etc/supervisor/conf.d/sync.conf
</span></span></span><span class=line><span class=cl><span class=s>[program:syncthing]
</span></span></span><span class=line><span class=cl><span class=s>directory=/home/apps/syncthing/syncthing-linux-amd64-v1.19.0
</span></span></span><span class=line><span class=cl><span class=s>command=/home/apps/syncthing/syncthing-linux-amd64-v1.19.0/syncthing
</span></span></span><span class=line><span class=cl><span class=s>autostart=true
</span></span></span><span class=line><span class=cl><span class=s>autorestart=true
</span></span></span><span class=line><span class=cl><span class=s>startsecs=10
</span></span></span><span class=line><span class=cl><span class=s>stdout_logfile=/var/log/supervisor/%(program_name)s-stdout.log
</span></span></span><span class=line><span class=cl><span class=s>stdout_logfile_maxbytes=5MB
</span></span></span><span class=line><span class=cl><span class=s>stdout_capture_maxbytes=5MB
</span></span></span><span class=line><span class=cl><span class=s>stdout_logfile_backups=5
</span></span></span><span class=line><span class=cl><span class=s>stderr_logfile=/var/log/supervisor/%(program_name)s-stderr.log
</span></span></span><span class=line><span class=cl><span class=s>stderr_logfile_maxbytes=5MB
</span></span></span><span class=line><span class=cl><span class=s>stderr_capture_maxbytes=5MB
</span></span></span><span class=line><span class=cl><span class=s>stderr_logfile_backups=5
</span></span></span><span class=line><span class=cl><span class=s>user = apps
</span></span></span><span class=line><span class=cl><span class=s>environment = HOME=&#34;/home/apps/syncthing/syncthing-linux-amd64-v1.19.0&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Make the newly created service effective</span>
</span></span><span class=line><span class=cl>$ sudo supervisorctl update
</span></span><span class=line><span class=cl><span class=c1># update: means update the list of services and re-run the new/modified services</span>
</span></span><span class=line><span class=cl><span class=c1># status: check the running status of all services</span>
</span></span><span class=line><span class=cl><span class=c1># start/stop/restart: start/stop/restart the service</span>
</span></span></code></pre></div><h2 id=systemd>systemd</h2><p><code>systemd</code> is the system suite that comes with the most distributions to replace <code>SysV init</code>, providing reliable parallelism during the boot process and centralized management of processes, daemons, services and mount points. It is a relatively heavyweight system, and unless there is a clear need to use it, it is generally not considered a way to run small applications (or commands) in the background.</p><p><code>systemd</code> common user unit configuration directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>$HOME</span>/.config/systemd/user
</span></span><span class=line><span class=cl>/usr/lib/systemd/user
</span></span><span class=line><span class=cl><span class=nv>$HOME</span>/.local/share/systemd/user
</span></span><span class=line><span class=cl>/etc/systemd/user
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Create file</span>
</span></span><span class=line><span class=cl>$ cat <span class=s>&lt;&lt;EOF &gt;$HOME/.config/systemd/user/sync.service
</span></span></span><span class=line><span class=cl><span class=s>[Unit]
</span></span></span><span class=line><span class=cl><span class=s>Description=Sync Files
</span></span></span><span class=line><span class=cl><span class=s>Documentation=https://syncthing.net
</span></span></span><span class=line><span class=cl><span class=s>After=network.target
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>[Service]
</span></span></span><span class=line><span class=cl><span class=s>Type=simple
</span></span></span><span class=line><span class=cl><span class=s>Environment=HOME=&#34;/home/apps/syncthing/syncthing-linux-amd64-v1.19.0&#34;
</span></span></span><span class=line><span class=cl><span class=s>ExecStart=/home/apps/syncthing/syncthing-linux-amd64-v1.19.0/syncthing
</span></span></span><span class=line><span class=cl><span class=s># Logging requires systemd version &gt; 240
</span></span></span><span class=line><span class=cl><span class=s>StandardOutput=append:/home/apps/syncthing/syncthing-linux-amd64-v1.19.0/logs/standard-output.log
</span></span></span><span class=line><span class=cl><span class=s>StandardError=append:/home/apps/syncthing/syncthing-linux-amd64-v1.19.0/logs/standard-error.log
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>[Install]
</span></span></span><span class=line><span class=cl><span class=s>WantedBy=multi-user.target
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ systemctl start sync --user
</span></span></code></pre></div><time datetime=2023-03-03>2023-03-03&nbsp;</time><div class=terminal-nav><div class=back-nav><a href=../ class=back-link>../</a></div></div></main><footer><p>Copyright 2025. All rights reserved.</p></footer></body></html>