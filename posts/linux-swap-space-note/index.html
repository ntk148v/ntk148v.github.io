<!doctype html><html><head><meta charset=utf-8><title>kiennt26's home | Swap space note</title><meta name=author content="map[email:kiennt2609@gmail.com name:Kien Nguyen-Tuan]"><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon_io/favicon.ico type=image/x-icon><link rel=icon href=/favicon_io/favicon-16x16.png size=16x16 type=image/png><link rel=icon href=/favicon_io/favicon-32x32.png size=32x32 type=image/png><link rel=preload type=text/css href=/css/rose-pine.min.css integrity as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet type=text/css href=/css/rose-pine.min.css integrity></noscript><link rel=preload type=text/css href="/css/toigian.min.1862cf4f3e8ae8d4cbaa9e763c34675fa2594301696de977455f0027acda3ff7.css" integrity="sha256-GGLPTz6K6NTLqp52PDRnX6JZQwFpbel3RV8AJ6zaP/c=" as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet type=text/css href="/css/toigian.min.1862cf4f3e8ae8d4cbaa9e763c34675fa2594301696de977455f0027acda3ff7.css" integrity="sha256-GGLPTz6K6NTLqp52PDRnX6JZQwFpbel3RV8AJ6zaP/c="></noscript><link rel=stylesheet type=text/css href="/css/light.min.29febe5c26ca625f7e2913e2509889a65637f415171eb003603102dea7cc42e0.css" integrity="sha256-Kf6+XCbKYl9+KRPiUJiJplY39BUXHrADYDEC3qfMQuA="><link rel=stylesheet type=text/css href="/css/dark.min.47fea451289f4f246c4875ba0aa5f6376183f220c766f5e90d15d6e48cb7b937.css" integrity="sha256-R/6kUSifTyRsSHW6CqX2N2GD8iDHZvXpDRXW5Iy3uTc="><script>localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><script defer src=/js/main.dfa968b06ebe7fb755eb156f7296445f20bd5ca0c82aa2eb755b1bfac4e2f294676471cf7670590073c364901a0dd5dc4b4c7b83f7a4a3c3b081f085c78fa1de.js integrity="sha512-36losG6+f7dV6xVvcpZEXyC9XKDIKqLrdVsb+sTi8pRnZHHPdnBZAHPDZJAaDdXcS0x7g/eko8OwgfCFx4+h3g=="></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script></head><body><header style=--layer:10><div aria-hidden=true class="absolute top-[-1000px] left-0 z-[calc(var(--layer)+1)] h-[calc(1000px+var(--page-top))] w-full bg-base"></div><div class="fixed top-0 left-0 z-[var(--layer)] flex h-header-height w-full items-center border-b px-page-gutter before:absolute before:inset-0 before:z-[-1] before:bg-base [@supports(backdrop-filter:blur(0))]:before:bg-base [@supports(backdrop-filter:blur(0))]:before:backdrop-blur-md"><div class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"><nav><ol class="flex text-md items-center"><li><a href=/ class="text-muted focus:underline focus:outline-none after:mx-[1ch]">kiennt26's home</a></li><li class="text-muted focus:underline focus:outline-none after:mx-[1ch]">/</li><li><a href=/posts/ class="text-muted focus:underline focus:outline-none after:mx-[1ch]">Posts</a></li><li class="text-muted focus:underline focus:outline-none after:mx-[1ch]">/</li><li><a href=/posts/linux-swap-space-note/ class="focus:underline focus:outline-none font-bold after:mx-[1ch]">Swap space note</a></li></ol></nav></div></div></header><main class="flex justify-center px-page-gutter py-page-top"><div class="min-h-content w-full max-w-content space-y-10 sm:space-y-20"><div class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"><nav><ol class="flex text-md items-center"><li><a href=/ class="text-muted focus:underline focus:outline-none after:mx-[1ch]">kiennt26's home</a></li><li class="text-muted focus:underline focus:outline-none after:mx-[1ch]">/</li><li><a href=/posts/ class="text-muted focus:underline focus:outline-none after:mx-[1ch]">Posts</a></li><li class="text-muted focus:underline focus:outline-none after:mx-[1ch]">/</li><li><a href=/posts/linux-swap-space-note/ class="focus:underline focus:outline-none font-bold after:mx-[1ch]">Swap space note</a></li></ol></nav></div><article><h1>Swap space note</h1><time class="text-sm italic tabular-nums text-muted">May 20, 2020&nbsp;</time><div class=section><a href=/tags/linux/ id=tag>linux</a>
<a href=/tags/tech/ id=tag>tech</a></div><details><summary>Table of contents</summary><div id=toc-list><nav id=TableOfContents><ol><li><a href=#1-what-is-swap>1. What is Swap?</a></li><li><a href=#2-swap-partition-size>2. Swap partition size</a><ol><li><a href=#21-old-rule-of-thumb>2.1. Old rule of thumb</a></li><li><a href=#22-what-is-the-right-amount-of-swap-space>2.2. What is the right amount of swap space?</a></li></ol></li><li><a href=#3-common-misconceptions--gotchas>3. Common misconceptions & gotchas</a><ol><li><a href=#31-increasing-swap-size-would-increase-performance>3.1. Increasing swap size would increase performance</a></li><li><a href=#32-swappiness>3.2. Swappiness</a></li><li><a href=#33-using-swap-as-emergency-memory>3.3. Using swap as emergency memory</a></li></ol></li><li><a href=#4-references>4. References</a></li></ol></nav></div></details><div class=content><h2 id=1-what-is-swap>1. What is Swap?</h2><p>Swap file systems support virtual memory, data is written to a swap file system when there is not enough RAM to store the data your system is processing.</p><h2 id=2-swap-partition-size>2. Swap partition size</h2><h3 id=21-old-rule-of-thumb>2.1. Old rule of thumb</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>swap = 2 * the-amount-of-RAM
</span></span></code></pre></div><p>So if a computer had 64KB of RAM, a swap partition of 128KB would be an optimum size. This rule took into the facts that RAM sizes were typically quite small at the time. Nowadays, RAM has become a <code>cheap</code> & <code>affordable</code> commondity, so the 2x rule is outdated.</p><h3 id=22-what-is-the-right-amount-of-swap-space>2.2. What is the right amount of swap space?</h3><p>Choosing the correct swap size is important. Too much swap space can hide memory leaks, also the storage space is allocated but idle. It can affect the system performance in general.</p><p>Follow the RedHat (CentOS 7x & RHEL 7) guide, the recommended size of a swap partition depending on the amount of RAM & whether you want sufficient memory for your system.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>swap &lt;= 10% * total-size-hard-drives &amp;&amp; swap &lt;= 128GB (if hibernation is allowed)
</span></span></code></pre></div><table><thead><tr><th>Amount of RAM</th><th>Recommended swap space</th><th>Recommended swap space if allowing for hibernation</th></tr></thead><tbody><tr><td>&lt; 2GB</td><td>2 * the-amount-of-RAM</td><td>3 * the-amount-of-RAM</td></tr><tr><td>> 2GB - 8GB</td><td>the-amount-of-RAM</td><td>2 * the-amount-of-RAM</td></tr><tr><td>> 8GB - 64GB</td><td>>= 4GB</td><td>1.5 * the-amount-of-RAM</td></tr><tr><td>> 64GB</td><td>>= 4GB</td><td>Hibernation not recommended</td></tr></tbody></table><h2 id=3-common-misconceptions--gotchas>3. Common misconceptions & gotchas</h2><h3 id=31-increasing-swap-size-would-increase-performance>3.1. Increasing swap size would increase performance</h3><ul><li>No, it wouldn&rsquo;t. Remember that the slowest part of memory is your hard-disk - <em>swap</em> just provides the ability to use more memory by swapping some pages out to the disk, which is <strong>slow</strong> compared to RAM operations. Swap can also <a href=https://askubuntu.com/questions/367881/does-swap-file-usage-increase-disk-i-o-and-cpu-load>increase disk I/O & CPU load</a>. This is a tradeoff. Without swap, the OOM may get you. It causes a downtime and in the real life scenario, the application can be slow a bit rather than down completely.</li></ul><h3 id=32-swappiness>3.2. Swappiness</h3><ul><li><p>The linux kernel tunable parameter <code>vm.swappiness</code> (/proc/sys/vm/swappiness) can be used to define how aggressively memory pages are swapped to disk.</p></li><li><p>The default value: <code>60</code>. The lower the value, the less swapping is used & the more memory pages are kept in the physical memory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>* 0: swap is disable.
</span></span><span class=line><span class=cl>* 1: minimum amount of swapping without disabling it entirely.
</span></span><span class=line><span class=cl>* 10: recommended value to improve performance when sufficient memory exists in a system
</span></span><span class=line><span class=cl>* 100: aggressive swapping
</span></span></code></pre></div></li><li><p>Useful commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Check the current value</span>
</span></span><span class=line><span class=cl>sysctl vm.swappiness
</span></span><span class=line><span class=cl><span class=c1># Adjust the value</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>10</span> &gt; /proc/sys/vm/swappiness
</span></span><span class=line><span class=cl>sysctl -w vm.swappiness<span class=o>=</span><span class=m>10</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;vm.swappiness = 10&#34;</span> &gt;&gt; /etc/sysctl.conf
</span></span></code></pre></div></li><li><p>On SSDs, swapping out anonymous pages and reclaiming file pages are essentially equivalent in terms of performance/latency. On older spinning disks, swap reads are slower due to random reads, so a lower vm.swappiness setting makes sense there.</p></li></ul><h3 id=33-using-swap-as-emergency-memory>3.3. Using swap as emergency memory</h3><ul><li>Swap is not generally about getting emergency memory, it&rsquo;s about making memory reclamation egalitarian and efficient. In fact, using it as &ldquo;emergency memory&rdquo; is generally actively harmful.</li></ul><h2 id=4-references>4. References</h2><ol><li><p><a href=https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/installation_guide/sect-disk-partitioning-setup-x86#sect-recommended-partitioning-scheme-x86>RedHad guideline</a></p></li><li><p><a href=https://chrisdown.name/2018/01/02/in-defence-of-swap.html>Chris Down&rsquo;s post</a></p></li><li><p><a href=https://linuxhint.com/understanding_vm_swappiness/>Linux Hint - Understanding vm.swappiness</a></p></li></ol></div><div class=mt-16></div></article></div></main><footer class="fixed left-0 bottom-0 w-full bg-base h-footer-height px-page-gutter"><div class="flex justify-center items-center h-footer-height"><div class="flex flex-row w-full max-w-content justify-between lowercase italic gap-3"><nav><ul class="flex text-md space-x-3 sm:space-x-6"><li class=text-text><a href=/contact class="tracking-wide hover:underline">Contact</a></li><li class=text-text><a href=/posts class="tracking-wide hover:underline">Posts</a></li></ul></nav><div id=header-theme-button><svg id="dark_mode_btn" class="hidden toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></svg><svg id="light_mode_btn" class="hidden toolbox-btn" width="18" height="18" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></svg></div></div></div></footer></body></html>