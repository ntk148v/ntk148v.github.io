<!doctype html><html><head><meta charset=utf-8><title>kiennt26's home
| Testing Ansible With Molecule</title><meta name=author content="map[email:kiennt2609@gmail.com name:Kien Nguyen-Tuan]"><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon_io/favicon.ico type=image/x-icon><link rel=icon href=/favicon_io/favicon-16x16.png size=16x16 type=image/png><link rel=icon href=/favicon_io/favicon-32x32.png size=32x32 type=image/png><link rel=alternate type=application/rss+xml href=https://ntk148v.github.io/index.xml title="kiennt26's home"><link rel=preload type=text/css href=/css/rose-pine.min.css integrity as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet type=text/css href=/css/rose-pine.min.css integrity></noscript><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&family=Inconsolata:wght@400;500;700&display=swap" rel=stylesheet><link rel=preload type=text/css href="/css/toigian.min.c66b71dcf2c5ab75c5b82be883d40e3f5850b87f3eac583602471348145e949c.css" integrity="sha256-xmtx3PLFq3XFuCvog9QOP1hQuH8+rFg2AkcTSBRelJw=" as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet type=text/css href="/css/toigian.min.c66b71dcf2c5ab75c5b82be883d40e3f5850b87f3eac583602471348145e949c.css" integrity="sha256-xmtx3PLFq3XFuCvog9QOP1hQuH8+rFg2AkcTSBRelJw="></noscript><link rel=stylesheet type=text/css href="/css/light.min.29febe5c26ca625f7e2913e2509889a65637f415171eb003603102dea7cc42e0.css" integrity="sha256-Kf6+XCbKYl9+KRPiUJiJplY39BUXHrADYDEC3qfMQuA="><link rel=stylesheet type=text/css href="/css/dark.min.47fea451289f4f246c4875ba0aa5f6376183f220c766f5e90d15d6e48cb7b937.css" integrity="sha256-R/6kUSifTyRsSHW6CqX2N2GD8iDHZvXpDRXW5Iy3uTc="><script>localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><script defer src=/js/main.dfa968b06ebe7fb755eb156f7296445f20bd5ca0c82aa2eb755b1bfac4e2f294676471cf7670590073c364901a0dd5dc4b4c7b83f7a4a3c3b081f085c78fa1de.js integrity="sha512-36losG6+f7dV6xVvcpZEXyC9XKDIKqLrdVsb+sTi8pRnZHHPdnBZAHPDZJAaDdXcS0x7g/eko8OwgfCFx4+h3g=="></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script></head><body><header style=--layer:10><div aria-hidden=true class="absolute top-[-1000px] left-0 z-[calc(var(--layer)+1)] h-[calc(1000px+var(--page-top))] w-full bg-base"></div><div class="fixed top-0 left-0 z-[var(--layer)] flex h-header-height w-full items-center border-b px-page-gutter before:absolute before:inset-0 before:z-[-1] before:bg-base [@supports(backdrop-filter:blur(0))]:before:bg-base [@supports(backdrop-filter:blur(0))]:before:backdrop-blur-md"><div class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"><nav><ol class="flex text-md items-center"><li><a href=/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">kiennt26's home</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Posts</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/testing-ansible-with-molecule/ class="focus:underline focus:outline-none font-bold after:md:mx-2 after:mx-0.5">Testing Ansible With Molecule</a></li></ol></nav><nav><a href=https://ntk148v.github.io/index.xml><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5.0 00-7.5-7.5H4.5m0-6.75h.75c7.87.0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75.0 11-1.5.0.75.75.0 011.5.0z"/></svg></a></nav></div></div></header><main class="flex justify-center px-page-gutter py-page-top"><div class="min-h-content w-full max-w-content space-y-10 sm:space-y-20"><div class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"><nav><ol class="flex text-md items-center"><li><a href=/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">kiennt26's home</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Posts</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/testing-ansible-with-molecule/ class="focus:underline focus:outline-none font-bold after:md:mx-2 after:mx-0.5">Testing Ansible With Molecule</a></li></ol></nav><nav><a href=https://ntk148v.github.io/index.xml><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5.0 00-7.5-7.5H4.5m0-6.75h.75c7.87.0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75.0 11-1.5.0.75.75.0 011.5.0z"/></svg></a></nav></div><article><h1>Testing Ansible With Molecule</h1><time class="text-sm italic tabular-nums text-muted">2023/03/20&nbsp;</time>
<nobr class="text-sm text-muted">&#8674&nbsp;</nobr><time class="text-sm italic tabular-nums text-muted">2023/03/20&nbsp;</time><div class=section><a href=/tags/tech/ id=tag>tech</a>
<a href=/tags/ansible/ id=tag>ansible</a></div><div class=content><blockquote class="my-5 p-4 rounded border-solid border-2 border-gold">The following content is rendered from <a href=https://github.com/ntk148v/til/blob/master/ansible/molecule.md>my #til github</a>.</blockquote><h1 id=testing-ansible-with-molecule>Testing Ansible with Molecule</h1><p>Source:</p><ul><li><a href=https://molecule.readthedocs.io/en/latest/getting-started/>https://molecule.readthedocs.io/en/latest/getting-started/</a></li><li><a href=https://www.jeffgeerling.com/blog/2018/testing-your-ansible-roles-molecule>https://www.jeffgeerling.com/blog/2018/testing-your-ansible-roles-molecule</a></li></ul><p>Table of contents:</p><ul><li><a href=#testing-ansible-with-molecule>Testing Ansible with Molecule</a><ul><li><a href=#0-problem>0. Problem</a></li><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-play-with-molecule>2. Play with Molecule</a><ul><li><a href=#21-getting-started>2.1. Getting started</a></li><li><a href=#22-custom-docker-image>2.2. Custom Docker image</a></li><li><a href=#23-test-an-existing-role>2.3. Test an existing role</a></li><li><a href=#24-test-cluster>2.4. Test Cluster</a></li></ul></li></ul></li></ul><h2 id=0-problem>0. Problem</h2><p>You wrote an Ansible playbook, good job, congratulations! Now you have to (should) check if the playbook works correctly. You may have multiple choices:</p><ul><li>Test in production ðŸ˜‡ Just do it, just run it! If something wrongs, fix and run it again.</li></ul><div style=width:480px><iframe allow=fullscreen frameborder=0 height=270 src=https://giphy.com/embed/AbOZR8G922HtmsfNlv/video width=480></iframe></div><ul><li>Create a testing environment, check playbook in it.</li></ul><p>Unless you&rsquo;re a brave hero or a careless person, you should go to option 2 - testing environment. Let&rsquo;s talk about it, the testing environment should be clean, so the procedure is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>- Spin up a VM.
</span></span><span class=line><span class=cl>- Run your playbook.
</span></span><span class=line><span class=cl>- Destroy the VM.
</span></span><span class=line><span class=cl>- If something went wrong, repeat from the first step
</span></span></code></pre></div><p>ðŸ™„ This is pretty inefficient. Another option is you might keep the same VM and clean up manually every time you finish your tests, which is also annoying. That&rsquo;s why we need <a href=https://molecule.readthedocs.io/en/latest/>Molecule</a> to make life easier.</p><h2 id=1-introduction>1. Introduction</h2><p>So the question is: &ldquo;What is Molecule?&rdquo;</p><ul><li>Molecule is a testing framework that is designed to aid in development and testing of Ansible roles (and playbooks too).</li><li>Molecule provides support for testing with multiple instances, operating systems and distributions, virtualization providers, test frameworks and testing scenarios.</li><li>Molecule encourages an approach that results in consistently developed roles that are well-written, easily understood and maintained.</li><li>Molecule supports only the latest <em>two major versions of Ansible (N/N-1)</em>, meaning that if the latest version is 2.9.x, we will also test our code with 2.8.x.</li></ul><h2 id=2-play-with-molecule>2. Play with Molecule</h2><blockquote><p>Source can be found <a href=https://github.com/ntk148v/testing/tree/master/ansible/molecule/example>here</a>.</p></blockquote><h3 id=21-getting-started>2.1. Getting started</h3><ul><li>You can install Molucule from pip/source, there are <a href=https://molecule.readthedocs.io/en/latest/installation>many options</a>, just choose one.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ pip install molecule
</span></span></code></pre></div><ul><li>Molecule requires an external Python dependency for the Docker driver.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ pip install <span class=s1>&#39;molecule[docker]&#39;</span>
</span></span><span class=line><span class=cl>$ molecule --version
</span></span><span class=line><span class=cl>molecule 4.0.4 using python 3.10
</span></span><span class=line><span class=cl>    ansible:2.14.3
</span></span><span class=line><span class=cl>    delegated:4.0.4 from molecule
</span></span><span class=line><span class=cl>    docker:2.1.0 from molecule_docker requiring collections: community.docker&gt;<span class=o>=</span>3.0.2 ansible.posix&gt;<span class=o>=</span>1.4.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ molecule drivers
</span></span><span class=line><span class=cl>â•¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•´
</span></span><span class=line><span class=cl>  delegated
</span></span><span class=line><span class=cl>  docker
</span></span></code></pre></div><ul><li>Before start integrating Molecule into an <em>existing role</em>, let&rsquo;s use Molecule itself to create a new role with the standard structure.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Molecule uses ansible-galaxy under the hood to generate conventional role layouts</span>
</span></span><span class=line><span class=cl>$ molecule init role kiennt26.example -d docker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>INFO     Initializing new role example...
</span></span><span class=line><span class=cl>Using /etc/ansible/ansible.cfg as config file
</span></span><span class=line><span class=cl>- Role example was created successfully
</span></span><span class=line><span class=cl><span class=o>[</span>WARNING<span class=o>]</span>: No inventory was parsed, only implicit localhost is available
</span></span><span class=line><span class=cl><span class=o>[</span>WARNING<span class=o>]</span>: error in <span class=s1>&#39;jsonfile&#39;</span> cache plugin <span class=k>while</span> trying to create cache dir
</span></span><span class=line><span class=cl>/etc/ansible/facts.d : b<span class=s2>&#34;[Errno 13] Permission denied: &#39;/etc/ansible/facts.d&#39;&#34;</span>
</span></span><span class=line><span class=cl>localhost <span class=p>|</span> <span class=nv>CHANGED</span> <span class=o>=</span>&gt; <span class=o>{</span><span class=s2>&#34;backup&#34;</span>: <span class=s2>&#34;&#34;</span>,<span class=s2>&#34;changed&#34;</span>: true,<span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;line added&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>INFO     Initialized role in /path/to/example successfully
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ tree example
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>example
</span></span><span class=line><span class=cl>â”œâ”€â”€ defaults
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span class=line><span class=cl>â”œâ”€â”€ files
</span></span><span class=line><span class=cl>â”œâ”€â”€ handlers
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span class=line><span class=cl>â”œâ”€â”€ meta
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span class=line><span class=cl>â”œâ”€â”€ molecule <span class=c1># &lt;---  here we go</span>
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ default
</span></span><span class=line><span class=cl>â”‚Â Â      â”œâ”€â”€ converge.yml
</span></span><span class=line><span class=cl>â”‚Â Â      â”œâ”€â”€ molecule.yml
</span></span><span class=line><span class=cl>â”‚Â Â      â””â”€â”€ verify.yml
</span></span><span class=line><span class=cl>â”œâ”€â”€ README.md
</span></span><span class=line><span class=cl>â”œâ”€â”€ tasks
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span class=line><span class=cl>â”œâ”€â”€ templates
</span></span><span class=line><span class=cl>â”œâ”€â”€ tests
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ inventory
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ test.yml
</span></span><span class=line><span class=cl>â””â”€â”€ vars
</span></span><span class=line><span class=cl>    â””â”€â”€ main.yml
</span></span></code></pre></div><ul><li>Inside <code>example/molecule</code>, there is a single <code>root_scenario</code> called <code>default</code>. Scenarios are the starting point for a lot of powerful functionality that Molecule offers.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>â”œâ”€â”€ molecule <span class=c1># &lt;---  here we go</span>
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ default <span class=c1># Scenario</span>
</span></span><span class=line><span class=cl>â”‚Â Â      â”œâ”€â”€ converge.yml <span class=c1># Playbook file that contains the call for your role</span>
</span></span><span class=line><span class=cl>â”‚Â Â      â”œâ”€â”€ molecule.yml  <span class=c1># The central configuration entrypoint for Molecule</span>
</span></span><span class=line><span class=cl>â”‚Â Â      â””â”€â”€ verify.yml <span class=c1># Ansible file used for testing as Anisble the default verifier.</span>
</span></span></code></pre></div><ul><li>Check <code>molecule.yml</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ cat example/molecule/default/molecule.yml
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>dependency: <span class=c1># Molecule uses galaxy development guide by default to resolve your role dependencies: &lt;https://docs.ansible.com/ansible/latest/galaxy/dev_guide.html&gt;</span>
</span></span><span class=line><span class=cl>  name: galaxy
</span></span><span class=line><span class=cl>driver: <span class=c1># Molecule use the driver to delegate the task of creating instances</span>
</span></span><span class=line><span class=cl>  name: docker
</span></span><span class=line><span class=cl>platforms: <span class=c1># To know which instances to create, name and to which group each instance belongs -&gt; test role against multiple distros</span>
</span></span><span class=line><span class=cl>  - name: instance
</span></span><span class=line><span class=cl>    image: quay.io/centos/centos:stream8
</span></span><span class=line><span class=cl>    pre_build_image: <span class=nb>true</span>
</span></span><span class=line><span class=cl>provisioner: <span class=c1># To control the scenario sequence order</span>
</span></span><span class=line><span class=cl>  name: ansible
</span></span><span class=line><span class=cl>verifier: <span class=c1># Specific state checking tests</span>
</span></span><span class=line><span class=cl>  name: ansible
</span></span></code></pre></div><ul><li>Molecule create an isntance:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ molecule create
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Create<span class=o>]</span> ******************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Set async_dir <span class=k>for</span> HOME env<span class=o>]</span> **********************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Log into a Docker registry<span class=o>]</span> **********************************************
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>=</span>None<span class=o>)</span>
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Check presence of custom Dockerfiles<span class=o>]</span> ************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: True<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Create Dockerfiles from image names<span class=o>]</span> *************************************
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: True<span class=o>})</span>
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Synchronization the context<span class=o>]</span> *********************************************
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: True<span class=o>})</span>
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Discover <span class=nb>local</span> Docker images<span class=o>]</span> ********************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;changed&#39;</span>: False, <span class=s1>&#39;skipped&#39;</span>: True, <span class=s1>&#39;skip_reason&#39;</span>: <span class=s1>&#39;Conditional result was False&#39;</span>, <span class=s1>&#39;item&#39;</span>: <span class=o>{</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: True<span class=o>}</span>, <span class=s1>&#39;ansible_loop_var&#39;</span>: <span class=s1>&#39;item&#39;</span>, <span class=s1>&#39;i&#39;</span>: 0, <span class=s1>&#39;ansible_index_var&#39;</span>: <span class=s1>&#39;i&#39;</span><span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Build an Ansible compatible image <span class=o>(</span>new<span class=o>)]</span> *********************************
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>=</span>molecule_local/quay.io/centos/centos:stream8<span class=o>)</span>
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Create docker network<span class=o>(</span>s<span class=o>)]</span> ************************************************
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Determine the CMD directives<span class=o>]</span> ********************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: True<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Create molecule instance<span class=o>(</span>s<span class=o>)]</span> *********************************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>=</span>instance<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Wait <span class=k>for</span> instance<span class=o>(</span>s<span class=o>)</span> creation to complete<span class=o>]</span> *******************************
</span></span><span class=line><span class=cl>FAILED - RETRYING: <span class=o>[</span>localhost<span class=o>]</span>: Wait <span class=k>for</span> instance<span class=o>(</span>s<span class=o>)</span> creation to <span class=nb>complete</span> <span class=o>(</span><span class=m>300</span> retries left<span class=o>)</span>.
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;failed&#39;</span>: 0, <span class=s1>&#39;started&#39;</span>: 1, <span class=s1>&#39;finished&#39;</span>: 0, <span class=s1>&#39;ansible_job_id&#39;</span>: <span class=s1>&#39;942472572382.94929&#39;</span>, <span class=s1>&#39;results_file&#39;</span>: <span class=s1>&#39;/home/user/.ansible_async/942472572382.94929&#39;</span>, <span class=s1>&#39;changed&#39;</span>: True, <span class=s1>&#39;item&#39;</span>: <span class=o>{</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: True<span class=o>}</span>, <span class=s1>&#39;ansible_loop_var&#39;</span>: <span class=s1>&#39;item&#39;</span><span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************
</span></span><span class=line><span class=cl>localhost                  : <span class=nv>ok</span><span class=o>=</span><span class=m>6</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>2</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>5</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>INFO     Running default &gt; prepare
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Check Docker list</span>
</span></span><span class=line><span class=cl>$ docker ps
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE                           COMMAND                  CREATED          STATUS          PORTS     NAMES
</span></span><span class=line><span class=cl>744e3b709b0c   quay.io/centos/centos:stream8   <span class=s2>&#34;bash -c &#39;while trueâ€¦&#34;</span>   <span class=m>32</span> seconds ago   Up <span class=m>31</span> seconds             instance
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Verify that Molecule has created the instance</span>
</span></span><span class=line><span class=cl>$ molecule list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>INFO     Running default &gt; list
</span></span><span class=line><span class=cl>                â•·             â•·                  â•·               â•·         â•·
</span></span><span class=line><span class=cl>  Instance Name â”‚ Driver Name â”‚ Provisioner Name â”‚ Scenario Name â”‚ Created â”‚ Converged
</span></span><span class=line><span class=cl>â•¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•´
</span></span><span class=line><span class=cl>  instance      â”‚ docker      â”‚ ansible          â”‚ default       â”‚ <span class=nb>true</span>    â”‚ <span class=nb>false</span>
</span></span></code></pre></div><ul><li>Add to <code>tasks/main.yml</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>- name: Molecule Hello World!
</span></span><span class=line><span class=cl>  ansible.builtin.debug:
</span></span><span class=line><span class=cl>    msg: Hello, World!
</span></span></code></pre></div><ul><li>Test our role against our instance:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ molecule converge
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Converge<span class=o>]</span> ****************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>instance<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Include kiennt26.example<span class=o>]</span> ************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>kiennt26.example : Molecule Hello World!<span class=o>]</span> ********************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>instance<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;Hello, World!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************
</span></span><span class=line><span class=cl>instance                   : <span class=nv>ok</span><span class=o>=</span><span class=m>2</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><ul><li>Clean up:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ molecule destroy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ molecule list
</span></span><span class=line><span class=cl>INFO     Running default &gt; list
</span></span><span class=line><span class=cl>                â•·             â•·                  â•·               â•·         â•·
</span></span><span class=line><span class=cl>  Instance Name â”‚ Driver Name â”‚ Provisioner Name â”‚ Scenario Name â”‚ Created â”‚ Converged
</span></span><span class=line><span class=cl>â•¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•´
</span></span><span class=line><span class=cl>  instance      â”‚ docker      â”‚ ansible          â”‚ default       â”‚ <span class=nb>false</span>   â”‚ <span class=nb>false</span>
</span></span><span class=line><span class=cl>                â•µ             â•µ                  â•µ               â•µ         â•µ
</span></span></code></pre></div><ul><li>To run a full test sequence:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ molecule <span class=nb>test</span>
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Converge<span class=o>]</span> ****************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>instance<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Include kiennt26.example<span class=o>]</span> ************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>kiennt26.example : Molecule Hello World!<span class=o>]</span> ********************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>instance<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;Hello, World!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************
</span></span><span class=line><span class=cl>instance                   : <span class=nv>ok</span><span class=o>=</span><span class=m>2</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>INFO     Running default &gt; idempotence
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Converge<span class=o>]</span> ****************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>instance<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Include kiennt26.example<span class=o>]</span> ************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>kiennt26.example : Molecule Hello World!<span class=o>]</span> ********************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>instance<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;Hello, World!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************
</span></span><span class=line><span class=cl>instance                   : <span class=nv>ok</span><span class=o>=</span><span class=m>2</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>INFO     Idempotence completed successfully.
</span></span><span class=line><span class=cl>INFO     Running default &gt; side_effect
</span></span><span class=line><span class=cl>WARNING  Skipping, side effect playbook not configured.
</span></span><span class=line><span class=cl>INFO     Running default &gt; verify
</span></span><span class=line><span class=cl>INFO     Running Ansible Verifier
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Verify<span class=o>]</span> ******************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Example assertion<span class=o>]</span> *******************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>instance<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;changed&#34;</span>: false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;All assertions passed&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************
</span></span><span class=line><span class=cl>instance                   : <span class=nv>ok</span><span class=o>=</span><span class=m>1</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>INFO     Verifier completed successfully.
</span></span><span class=line><span class=cl>INFO     Running default &gt; cleanup
</span></span><span class=line><span class=cl>WARNING  Skipping, cleanup playbook not configured.
</span></span><span class=line><span class=cl>INFO     Running default &gt; destroy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Destroy<span class=o>]</span> *****************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Set async_dir <span class=k>for</span> HOME env<span class=o>]</span> **********************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Destroy molecule instance<span class=o>(</span>s<span class=o>)]</span> ********************************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>=</span>instance<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Wait <span class=k>for</span> instance<span class=o>(</span>s<span class=o>)</span> deletion to complete<span class=o>]</span> *******************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>=</span>instance<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Delete docker networks<span class=o>(</span>s<span class=o>)]</span> ***********************************************
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************
</span></span><span class=line><span class=cl>localhost                  : <span class=nv>ok</span><span class=o>=</span><span class=m>3</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>2</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>1</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>INFO     Pruning extra files from scenario ephemeral directory
</span></span></code></pre></div><ul><li>With Molecule, any time you want to bring up a local environment and start running your role, you just run <code>molecule converge</code>. And since you can use Molecule with Docker, Virtualbox,&mldr; you can have your roles run inside any type of virtual environment you need (Sometimes it can be hard to test certain types of applications or automation inside of Docker container).</li></ul><h3 id=22-custom-docker-image>2.2. Custom Docker image</h3><ul><li><p>The Docker driver supports using pre-built images and <code>docker build</code>-ing local customizations for each scenario&rsquo;s platform.</p></li><li><p>The Docker image use by a scenario is governed by the following configuration items:</p><ul><li><code>platforms[*].image</code>: Docker image name:tag to use as base image.</li><li><code>platforms[*].pre_build_image</code>: Whether to customize base image or use as-is:<ul><li><code>true</code>: use the specified <code>platforms[*].image</code> as-is.</li><li><code>false</code>: exec Docker build to customize base image using either:<ul><li>Dockerfile specified by <code>platforms[*].dockerfile</code> or</li><li>Dockerfile rendered from <code>Dockerfile.j2</code> template (in scenario dir).</li></ul></li></ul></li></ul></li><li><p>Create the scenario with custom Docker image:</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ molecule init scenario -d docker custom-image
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>INFO     Initializing new scenario custom-image...
</span></span><span class=line><span class=cl>INFO     Initialized scenario in /path/to/example/molecule/custom-image successfully.
</span></span></code></pre></div><ul><li>Change to <code>platforms[*].pre_build_image</code> to <code>false</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>platforms</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>instance</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>quay.io/centos/centos:stream8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pre_build_image</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span></code></pre></div><ul><li>Create the custom Dockerfile.j2:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=c># Molecule managed</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=o>{</span>% <span class=k>if</span> item.registry is defined %<span class=o>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> {{ item.registry.url }}/{{ item.image }}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=o>{</span>% <span class=k>else</span> %<span class=o>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> {{ item.image }}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=o>{</span>% endif %<span class=o>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> <span class=k>if</span> <span class=o>[</span> <span class=k>$(</span><span class=nb>command</span> -v apt-get<span class=k>)</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>                                                        apt-get update <span class=o>&amp;&amp;</span> apt-get install -y python sudo bash ca-certificates iproute2 init <span class=o>&amp;&amp;</span> apt-get clean<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=k>elif</span> <span class=o>[</span> <span class=k>$(</span><span class=nb>command</span> -v zypper<span class=k>)</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>                                                       zypper refresh <span class=o>&amp;&amp;</span> zypper install -y python sudo bash python-xml iproute2 systemd-sysvinit <span class=o>&amp;&amp;</span> zypper clean -a<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=k>elif</span> <span class=o>[</span> <span class=k>$(</span><span class=nb>command</span> -v apk<span class=k>)</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>                                                          apk update <span class=o>&amp;&amp;</span> apk add --no-cache python sudo bash ca-certificates<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=k>elif</span> <span class=o>[</span> <span class=k>$(</span><span class=nb>command</span> -v xbps-install<span class=k>)</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>                                                 xbps-install -Syu <span class=o>&amp;&amp;</span> xbps-install -y python sudo bash ca-certificates iproute2 <span class=o>&amp;&amp;</span> xbps-remove -O<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=k>elif</span> <span class=o>[</span> <span class=k>$(</span><span class=nb>command</span> -v swupd<span class=k>)</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>                                                        swupd bundle-add python3-basic sudo iproute2<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=k>elif</span> <span class=o>[</span> <span class=k>$(</span><span class=nb>command</span> -v dnf<span class=k>)</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> cat /etc/os-release <span class=p>|</span> grep -q <span class=s1>&#39;^NAME=Fedora&#39;</span> <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>           cat /etc/os-release <span class=p>|</span> grep -q <span class=s1>&#39;^VERSION_ID=30&#39;</span><span class=p>;</span> <span class=k>then</span>                               dnf makecache <span class=o>&amp;&amp;</span> dnf --assumeyes install python sudo python-devel python3-dnf bash iproute <span class=o>&amp;&amp;</span> dnf clean all<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=k>elif</span> <span class=o>[</span> <span class=k>$(</span><span class=nb>command</span> -v dnf<span class=k>)</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> cat /etc/os-release <span class=p>|</span> grep -q <span class=s1>&#39;^NAME=Fedora&#39;</span><span class=p>;</span> <span class=k>then</span>          dnf makecache <span class=o>&amp;&amp;</span> dnf --assumeyes install python sudo python-devel python*-dnf bash iproute <span class=o>&amp;&amp;</span> dnf clean all<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=k>elif</span> <span class=o>[</span> <span class=k>$(</span><span class=nb>command</span> -v dnf<span class=k>)</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> cat /etc/os-release <span class=p>|</span> grep -q <span class=s1>&#39;^NAME=&#34;CentOS Linux&#34;&#39;</span> <span class=p>;</span> <span class=k>then</span> dnf makecache <span class=o>&amp;&amp;</span> dnf --assumeyes install python36 sudo platform-python-devel python*-dnf bash iproute <span class=o>&amp;&amp;</span> dnf clean all <span class=o>&amp;&amp;</span> ln -s /usr/bin/python3 /usr/bin/python<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=k>elif</span> <span class=o>[</span> <span class=k>$(</span><span class=nb>command</span> -v yum<span class=k>)</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>                                                          yum makecache fast <span class=o>&amp;&amp;</span> yum install -y python sudo yum-plugin-ovl bash iproute <span class=o>&amp;&amp;</span> sed -i <span class=s1>&#39;s/plugins=0/plugins=1/g&#39;</span> /etc/yum.conf <span class=o>&amp;&amp;</span> yum clean all<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=k>fi</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Centos:8 + ansible 2.7 failed with error: &#34;The module failed to execute correctly, you probably need to set the interpreter&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Solution: ln -s /usr/bin/python3 /usr/bin/python</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Fedora:30 deprecated python2-dnf</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Solution: explicitly use python3-dnf instead</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># https://github.com/ansible/ansible/issues/54855</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># https://github.com/ansible/ansible/issues/59248</span><span class=err>
</span></span></span></code></pre></div><ul><li>Customize <code>example/custom-image/molecule.yml</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>platforms</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>instance-${MOLECULE_DISTRO:-&#39;quay.io/centos/centos:stream8&#39;}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>${MOLECULE_DISTRO:-&#39;quay.io/centos/centos:stream8&#39;}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pre_build_image</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span></code></pre></div><ul><li>Start the instances:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ molecule create -s custom-image -d docker
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Create<span class=o>]</span> ******************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Set async_dir <span class=k>for</span> HOME env<span class=o>]</span> **********************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Log into a Docker registry<span class=o>]</span> **********************************************
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>=</span>None<span class=o>)</span>
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Check presence of custom Dockerfiles<span class=o>]</span> ************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance-quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: False<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Create Dockerfiles from image names<span class=o>]</span> *************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance-quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: False<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Synchronization the context<span class=o>]</span> *********************************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance-quay.io/centos/centos:stream8&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: False<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Discover <span class=nb>local</span> Docker images<span class=o>]</span> ********************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>=</span>None<span class=o>)</span>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Build an Ansible compatible image <span class=o>(</span>new<span class=o>)]</span> *********************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># You want to change to another base image</span>
</span></span><span class=line><span class=cl>$ <span class=nv>MOLECULE_DISTRO</span><span class=o>=</span>ubuntu:22.04 molecule create -s custom-image -d docker
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Create<span class=o>]</span> ******************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Set async_dir <span class=k>for</span> HOME env<span class=o>]</span> **********************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Log into a Docker registry<span class=o>]</span> **********************************************
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>=</span>None<span class=o>)</span>
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Check presence of custom Dockerfiles<span class=o>]</span> ************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;ubuntu:22.04&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance-ubuntu:22.04&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: False<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Create Dockerfiles from image names<span class=o>]</span> *************************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;ubuntu:22.04&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance-ubuntu:22.04&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: False<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Synchronization the context<span class=o>]</span> *********************************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;ubuntu:22.04&#39;</span>, <span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;instance-ubuntu:22.04&#39;</span>, <span class=s1>&#39;pre_build_image&#39;</span>: False<span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Discover <span class=nb>local</span> Docker images<span class=o>]</span> ********************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>=</span>None<span class=o>)</span>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>localhost<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Build an Ansible compatible image <span class=o>(</span>new<span class=o>)]</span> *********************************
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span></code></pre></div><h3 id=23-test-an-existing-role>2.3. Test an existing role</h3><p>If you want to initialize Molecule within an existing role, you would use the <code>molecule init scenario -r my_role_name my_scenario</code> command from within the role&rsquo;s directory.</p><h3 id=24-test-cluster>2.4. Test Cluster</h3><ul><li>Create new scenario:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ molecule init scenario -d docker cluster
</span></span></code></pre></div><ul><li>Modify <code>example/molecule/cluster/molecule.yml</code> to create 3 hosts:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>platforms</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>instance-0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>quay.io/centos/centos:stream8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pre_build_image</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>instance-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>quay.io/centos/centos:stream8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pre_build_image</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>instance-2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>quay.io/centos/centos:stream8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pre_build_image</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><ul><li>You can also take advantage of yaml <a href=https://learnxinyminutes.com/docs/yaml/>anchor and merge key features</a> to make it shorter (if your instance definition is complicated, and you don&rsquo;t to waste your time repeat it):<ul><li>Note: anchors and merge keys can only be used in the same yaml file. So this will not work between different scenario.</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>platforms</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=cp>&amp;default-instance</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>instance-0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>quay.io/centos/centos:stream8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pre_build_image</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>groups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># command: /sbin/init</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># volumes:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#   - /sys/fs/cgroup:/sys/fs/cgroup:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># networks:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#   - name: net1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=cp>*default-instance</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>instance-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=cp>*default-instance</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>instance-2</span><span class=w>
</span></span></span></code></pre></div><ul><li>Start instances:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ molecule create -s cluster
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ molecule list -s cluster
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Instance Name â”‚ Driver Name â”‚ Provisioner Name â”‚ Scenario Name â”‚ Created â”‚ Converged
</span></span><span class=line><span class=cl>â•¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•´
</span></span><span class=line><span class=cl>  instance-0    â”‚ docker      â”‚ ansible          â”‚ cluster       â”‚ <span class=nb>true</span>    â”‚ <span class=nb>false</span>
</span></span><span class=line><span class=cl>  instance-1    â”‚ docker      â”‚ ansible          â”‚ cluster       â”‚ <span class=nb>true</span>    â”‚ <span class=nb>false</span>
</span></span><span class=line><span class=cl>  instance-2    â”‚ docker      â”‚ ansible          â”‚ cluster       â”‚ <span class=nb>true</span>    â”‚ <span class=nb>false</span>
</span></span><span class=line><span class=cl>                â•µ             â•µ                  â•µ               â•µ         â•µ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker ps
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE                           COMMAND                  CREATED          STATUS          PORTS     NAMES
</span></span><span class=line><span class=cl>8fe77dd8e250   quay.io/centos/centos:stream8   <span class=s2>&#34;bash -c &#39;while trueâ€¦&#34;</span>   <span class=m>34</span> seconds ago   Up <span class=m>33</span> seconds             instance-2
</span></span><span class=line><span class=cl>0dee3cd04c07   quay.io/centos/centos:stream8   <span class=s2>&#34;bash -c &#39;while trueâ€¦&#34;</span>   <span class=m>35</span> seconds ago   Up <span class=m>34</span> seconds             instance-1
</span></span><span class=line><span class=cl>9004da1f541d   quay.io/centos/centos:stream8   <span class=s2>&#34;bash -c &#39;while trueâ€¦&#34;</span>   <span class=m>36</span> seconds ago   Up <span class=m>35</span> seconds             instance-0
</span></span></code></pre></div><ul><li>Molecule doesn&rsquo;t have an inventory file, so you must define host group in <code>example/molecule/cluster/molecule.yml</code> file.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>platforms</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=cp>&amp;default-instance</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>instance-0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>quay.io/centos/centos:stream8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pre_build_image</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>groups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>test</span><span class=w> </span><span class=c># &lt;-- your group</span><span class=w>
</span></span></span></code></pre></div></div><div class=mt-16><script src=https://giscus.app/client.js data-repo=ntk148v/ntk148v.github.io data-repo-id=R_kgDOIWtaXA data-category="Show and tell" data-category-id=DIC_kwDOIWtaXM4CSU-P data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></div></article></div></main><footer class="fixed left-0 bottom-0 w-full bg-base px-page-gutter"><div class="flex justify-center items-center h-footer-height"><div class="flex flex-row w-full max-w-content justify-between lowercase italic gap-3"><nav><ul class="flex text-md space-x-3 sm:space-x-6"><li class=text-text><a href=/contact class="tracking-wide hover:underline">Contact</a></li><li class=text-text><a href=/posts class="tracking-wide hover:underline">Posts</a></li></ul></nav><span class="text-muted hidden md:block">&copy;
2023
<a href=https://github.com/ntk148v/hugo-toigian class="font-bold hover:underline">hugo-toigian</a></span><div id=header-theme-button><svg id="dark_mode_btn" class="hidden toolbox-btn" width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718.0 0118 15.75c-5.385.0-9.75-4.365-9.75-9.75.0-1.33.266-2.597.748-3.752A9.753 9.753.0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753.0 009.002-5.998z"/></svg><svg id="light_mode_btn" class="hidden toolbox-btn" width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75.0 11-7.5.0 3.75 3.75.0 017.5.0z"/></svg></div></div></div></footer></body></html>