<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Author: Kien Nguyen <kiennt2609@gmail.com>
      A minimal Hugo theme with Tailwind CSS"><title>kiennt26's home
| Atop
</title><meta name=author content="map[email:kiennt2609@gmail.com name:Kien Nguyen-Tuan]"><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon_io/favicon.ico type=image/x-icon><link rel=icon href=/favicon_io/favicon-16x16.png size=16x16 type=image/png><link rel=icon href=/favicon_io/favicon-32x32.png size=32x32 type=image/png><link rel=preload type=text/css href=/css/rose-pine.min.css integrity as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet type=text/css href=/css/rose-pine.min.css integrity></noscript><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Overpass+Mono:wght@400;500;700&family=Overpass:wght@400;500;700&display=swap" rel=stylesheet><link rel=preload type=text/css href="/css/toigian.min.c2d412fa9d783008621ed5702bba8f6e06deae862875592a7f6ffc928110308a.css" integrity="sha256-wtQS+p14MAhiHtVwK7qPbgberoYodVkqf2/8koEQMIo=" as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet type=text/css href="/css/toigian.min.c2d412fa9d783008621ed5702bba8f6e06deae862875592a7f6ffc928110308a.css" integrity="sha256-wtQS+p14MAhiHtVwK7qPbgberoYodVkqf2/8koEQMIo="></noscript><link rel=stylesheet type=text/css href="/css/light.min.29febe5c26ca625f7e2913e2509889a65637f415171eb003603102dea7cc42e0.css" integrity="sha256-Kf6+XCbKYl9+KRPiUJiJplY39BUXHrADYDEC3qfMQuA="><link rel=stylesheet type=text/css href="/css/dark.min.47fea451289f4f246c4875ba0aa5f6376183f220c766f5e90d15d6e48cb7b937.css" integrity="sha256-R/6kUSifTyRsSHW6CqX2N2GD8iDHZvXpDRXW5Iy3uTc="><script>localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><script async defer src=/js/main.dfa968b06ebe7fb755eb156f7296445f20bd5ca0c82aa2eb755b1bfac4e2f294676471cf7670590073c364901a0dd5dc4b4c7b83f7a4a3c3b081f085c78fa1de.js integrity="sha512-36losG6+f7dV6xVvcpZEXyC9XKDIKqLrdVsb+sTi8pRnZHHPdnBZAHPDZJAaDdXcS0x7g/eko8OwgfCFx4+h3g=="></script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script></head><body><header style=--layer:10><div aria-hidden=true class="absolute top-[-1000px] left-0 z-[calc(var(--layer)+1)] h-[calc(1000px+var(--page-top))] w-full bg-base"></div><div class="fixed top-0 left-0 z-[var(--layer)] flex h-header-height w-full items-center border-b px-page-gutter before:absolute before:inset-0 before:z-[-1] before:bg-base [@supports(backdrop-filter:blur(0))]:before:bg-base [@supports(backdrop-filter:blur(0))]:before:backdrop-blur-md"><div class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"><nav><ol class="flex text-md items-center"><li><a href=/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">kiennt26's home</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Posts</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/atop/ class="focus:underline focus:outline-none font-bold after:md:mx-2 after:mx-0.5">Atop</a></li></ol></nav><nav><a href=https://ntk148v.github.io//index.xml><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5.0 00-7.5-7.5H4.5m0-6.75h.75c7.87.0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75.0 11-1.5.0.75.75.0 011.5.0z"/></svg></a></nav></div></div></header><main class="flex justify-center px-page-gutter py-page-top"><div class="min-h-content w-full max-w-content space-y-10 sm:space-y-20"><div class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"><nav><ol class="flex text-md items-center"><li><a href=/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">kiennt26's home</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Posts</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/atop/ class="focus:underline focus:outline-none font-bold after:md:mx-2 after:mx-0.5">Atop</a></li></ol></nav><nav><a href=https://ntk148v.github.io//index.xml><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5.0 00-7.5-7.5H4.5m0-6.75h.75c7.87.0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75.0 11-1.5.0.75.75.0 011.5.0z"/></svg></a></nav></div><article><h1>Atop</h1><time class="text-sm italic tabular-nums text-muted">2024/06/20&nbsp;</time>
<nobr class="text-sm text-muted">&#8674&nbsp;</nobr><time class="text-sm italic tabular-nums text-muted">2024/06/20&nbsp;</time><div class=section><a href=/tags/tech/ id=tag>Tech</a>
<a href=/tags/linux/ id=tag>Linux</a>
<a href=/tags/tool/ id=tag>Tool</a></div><div id=toc><details open><summary>Table of contents</summary><div id=toc-list><nav id=TableOfContents><ol><li><a href=#installation>Installation</a></li><li><a href=#first-look>First look</a><ol><li><a href=#system-level-top-section>System level (top section)</a></li><li><a href=#process-level-bottom-section>Process level (bottom section)</a></li></ol></li><li><a href=#background-running>Background running</a></li><li><a href=#useful-commands-and-shortcut>Useful commands and shortcut</a></li><li><a href=#for-advanced-users>For advanced users</a><ol><li><a href=#thread-information>Thread information</a></li><li><a href=#disk-activity-information>Disk activity information</a></li><li><a href=#memory-leaks>Memory leaks</a></li></ol></li></ol></nav></div></details></div><div class=content><p>Source:</p><ul><li><a href=https://www.redhat.com/sysadmin/analyzing-linux-server-performance-atop>https://www.redhat.com/sysadmin/analyzing-linux-server-performance-atop</a></li><li><a href=http://freesoftwaremagazine.com/articles/atop_when_you_need_know_exactly_whats_happening_systemresource_level/>http://freesoftwaremagazine.com/articles/atop_when_you_need_know_exactly_whats_happening_systemresource_level/</a></li><li><a href=https://www.digitalocean.com/community/tutorials/atop-command-in-linux>https://www.digitalocean.com/community/tutorials/atop-command-in-linux</a></li><li><a href=https://www.atoptool.nl/index.php>https://www.atoptool.nl/index.php</a></li></ul><p><code>top</code> is great, we&rsquo;re all familiar with it. <code>htop</code> is even better, (and with eye-catching look). But sometimes these tools aren&rsquo;t enough, they only give the 10,000 foot overview of resource. They don&rsquo;t allow you to see what part of which program or process is eating up too much RAM or which part is creating race conditions on lock files. And the most important drawback is the lack of historical data. But <a href=https://www.atoptool.nl/index.php><code>atop</code></a> can. A powerful monitor program that allows you to see system-level counters concerning utilization of CPU and memory/swap, as well as see disk I/O and network utilization counters at the system level &ndash; in real time or <em>historically</em>. It also allows you to store raw counters in a file for long-term analysis on system levels and process levels, as well as seeing resource consumption for each thread within a process of a multi-processor program.</p><h2 id=installation>Installation</h2><p>Installation is as simple as opening your package manager and selecting it for installation.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># RedHat CentOS</span>
</span></span><span class=line><span class=cl>yum install atop
</span></span><span class=line><span class=cl><span class=c1># Ubuntu Debian</span>
</span></span><span class=line><span class=cl>apt install atop
</span></span></code></pre></div><h2 id=first-look>First look</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>atop
</span></span></code></pre></div><p>Once atop is launched, by default it shows system activity for CPU, memory, swap, disks, and network in 10-second intervals. In addition, for each process and thread, you can analyze CPU utilization, memory consumption, disk I/O, priority, username, state, and even exit codes:</p><figure class=figure><img src=/photos/atop/atop-overview.png></figure><p>The first thing that you&rsquo;ll notice is that there is a lot of information on that one screen. The second thing you should notice is that the window is resizeable. This feature allows you to see what&rsquo;s in each column instead of it being cut off, with no way to know what&rsquo;s there. Enlarging the screen during some operations will add additional columns with even more information in them.</p><p>The screen is divided into two broad sections:</p><h3 id=system-level-top-section>System level (top section)</h3><p>In the top section, each line is a resource type (first column):</p><ul><li>PRC (process level totals)</li><li>CPU, CPL (CPU load information)</li><li>MEM, SWP (swap occupation and overcommit info)</li><li>PAG (paging frequency)</li><li>LVM/MDD/DSK (logical volume/multiple device/disk utilization)</li><li>NET.</li></ul><p>If you have more than one CPU or core, you will have one main row called CPU (in capitals) and then one extra row per core called cpu (small letters).</p><h3 id=process-level-bottom-section>Process level (bottom section)</h3><p>The process level section will show something similar to what you are used to with the top program. Note that the output is also nicely paginated (^F to go forward, ^B to go back).</p><p>You can control the output of the atop command from your keyboard. Remember that you can always make the screen wider to show more details.</p><ul><li><code>m</code> for memory related output;</li><li><code>d</code> for disk-related output;</li><li><code>n</code> for network related output;</li><li><code>v</code> for various process characteristics;</li><li><code>c</code> for the command line of the process.</li></ul><h2 id=background-running>Background running</h2><p>Atop runs as a daemon (systemd service). If you don&rsquo;t want it running, simply kill it. Atop also creates log files in the standard log file location for your distro.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>systemctl status atop
</span></span><span class=line><span class=cl>● atop.service - Atop advanced performance monitor
</span></span><span class=line><span class=cl>     Loaded: loaded <span class=o>(</span>/lib/systemd/system/atop.service<span class=p>;</span> enabled<span class=p>;</span> vendor preset: enabled<span class=o>)</span>
</span></span><span class=line><span class=cl>     Active: active <span class=o>(</span>running<span class=o>)</span> since Thu 2024-06-20 09:44:07 UTC<span class=p>;</span> 8min ago
</span></span><span class=line><span class=cl>       Docs: man:atop<span class=o>(</span>1<span class=o>)</span>
</span></span><span class=line><span class=cl>    Process: <span class=m>12406</span> <span class=nv>ExecStartPre</span><span class=o>=</span>/bin/sh -c <span class=nb>test</span> -n <span class=s2>&#34;</span><span class=nv>$LOGINTERVAL</span><span class=s2>&#34;</span> -a <span class=s2>&#34;</span><span class=nv>$LOGINTERVAL</span><span class=s2>&#34;</span> -eq <span class=s2>&#34;</span><span class=nv>$LOGINTERVAL</span><span class=s2>&#34;</span> <span class=o>(</span><span class=nv>code</span><span class=o>=</span>exited, <span class=nv>status</span><span class=o>=</span>0/SUCCESS<span class=o>)</span>
</span></span><span class=line><span class=cl>    Process: <span class=m>12407</span> <span class=nv>ExecStartPre</span><span class=o>=</span>/bin/sh -c <span class=nb>test</span> -n <span class=s2>&#34;</span><span class=nv>$LOGGENERATIONS</span><span class=s2>&#34;</span> -a <span class=s2>&#34;</span><span class=nv>$LOGGENERATIONS</span><span class=s2>&#34;</span> -eq <span class=s2>&#34;</span><span class=nv>$LOGGENERATIONS</span><span class=s2>&#34;</span> <span class=o>(</span><span class=nv>code</span><span class=o>=</span>exited, <span class=nv>status</span><span class=o>=</span>0/SUCCESS<span class=o>)</span>
</span></span><span class=line><span class=cl>    Process: <span class=m>12409</span> <span class=nv>ExecStartPost</span><span class=o>=</span>/usr/bin/find <span class=si>${</span><span class=nv>LOGPATH</span><span class=si>}</span> -name atop_* -mtime +<span class=si>${</span><span class=nv>LOGGENERATIONS</span><span class=si>}</span> -exec rm -v <span class=o>{}</span> <span class=p>;</span> <span class=o>(</span><span class=nv>code</span><span class=o>=</span>exited, <span class=nv>status</span><span class=o>=</span>0/SUCCESS<span class=o>)</span>
</span></span><span class=line><span class=cl>   Main PID: <span class=m>12408</span> <span class=o>(</span>atop<span class=o>)</span>
</span></span><span class=line><span class=cl>      Tasks: <span class=m>1</span> <span class=o>(</span>limit: 4557<span class=o>)</span>
</span></span><span class=line><span class=cl>     Memory: 7.6M
</span></span><span class=line><span class=cl>        CPU: 28ms
</span></span><span class=line><span class=cl>     CGroup: /system.slice/atop.service
</span></span><span class=line><span class=cl>             └─12408 /usr/bin/atop -R -w /var/log/atop/atop_20240620 <span class=m>600</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Jun <span class=m>20</span> 09:44:07 vm1 systemd<span class=o>[</span>1<span class=o>]</span>: Starting Atop advanced performance monitor...
</span></span><span class=line><span class=cl>Jun <span class=m>20</span> 09:44:07 vm1 systemd<span class=o>[</span>1<span class=o>]</span>: Started Atop advanced performance monitor.
</span></span></code></pre></div><p>Default config stores at <code>/etc/default/atop</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># /etc/default/atop</span>
</span></span><span class=line><span class=cl><span class=c1># see man atoprc for more possibilities to configure atop execution</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>LOGOPTS</span><span class=o>=</span><span class=s2>&#34;-R&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>LOGINTERVAL</span><span class=o>=</span><span class=m>600</span>
</span></span><span class=line><span class=cl><span class=nv>LOGGENERATIONS</span><span class=o>=</span><span class=m>28</span>
</span></span><span class=line><span class=cl><span class=nv>LOGPATH</span><span class=o>=</span>/var/log/atop
</span></span></code></pre></div><p>You can modify this file to change atop behavior. The log files are compressed and must be read by atop. To view a log file, type:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>atop -r /var/log/atop/atop_20240620
</span></span></code></pre></div><p>Then use <code>t</code> to go forward in 10 minute intervals and <code>T</code> to go back. You can analyze specific times by pressing <code>b</code> then entering the time.</p><h2 id=useful-commands-and-shortcut>Useful commands and shortcut</h2><p>First thing first, read the man pages:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>man atop
</span></span></code></pre></div><p>Useful <code>atop</code> launch commands include:</p><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td>atop -1</td><td>Launch with average-per-second total values.</td></tr><tr><td>atop -a</td><td>Launch with active processes only.</td></tr><tr><td>atop -c</td><td>Launch with command-line per process.</td></tr><tr><td>atop -d</td><td>Launch with disk info.</td></tr><tr><td>atop -m</td><td>Launch with memory info.</td></tr><tr><td>atop -n</td><td>Launch with network info.</td></tr><tr><td>atop -s</td><td>Launch with scheduling info.</td></tr><tr><td>atop -v</td><td>Launch with various info (e.g., PPID, user, or time).</td></tr><tr><td>atop -y</td><td>Launch with individual threads.</td></tr></tbody></table><p>Once <code>atop</code> is running, press the following shortcut keys to sort processes:</p><table><thead><tr><th>Shortcut key</th><th>Description</th></tr></thead><tbody><tr><td>a</td><td>Sort in order of most active resources.</td></tr><tr><td>c</td><td>Revert to sorting by CPU consumption (default).</td></tr><tr><td>d</td><td>Sort in order of disk activity.</td></tr><tr><td>m</td><td>Sort in order of memory usage.</td></tr><tr><td>n</td><td>Sort in order of network activity.</td></tr></tbody></table><h2 id=for-advanced-users>For advanced users</h2><h3 id=thread-information>Thread information</h3><p>Developers writing multi-core, multi-thread programs can press the <code>s</code> key while their program is running to show specific scheduling information about the main thread of each process. For example, scheduling policy, nice value, priority, real time priority and CPU number (current or last used) and state.</p><p>Furthermore it shows how many threads within this process are in the state &lsquo;running&rsquo; (busy on CPU or waiting in the run queue), &lsquo;interruptible sleeping&rsquo; or &rsquo;non-interruptible sleeping&rsquo;. The total number of threads can be determined by accumulating these three values (columns TRUN, TSLPI and TSLPU).</p><h3 id=disk-activity-information>Disk activity information</h3><p>Trying to debug a program where your disk writes aren&rsquo;t getting written to disk is very frustrating. You may have a function calling another function, calling another function and can&rsquo;t figure out why nothing is getting written to disk. Atop to the rescue. Press the <code>d</code> key. The lines with label LVM (logical volumes) and DSK (underlying physical disks) shows the disk-activity on system-level.</p><p>On process-level the disk activity is shown as the amount of data transferred by reads (column RDDSK) and writes (column WRDSK). Usually the written data is stored in the in-memory page cache before it is physically written to disk. When the data is written to the page cache but destroyed before physically written to disk, that amount is reported as canceled (column WCANCL).</p><p>Make the window larger and columns are added for the system level statistics, like the number of Kb transferred per read and write request, the total throughput per second for reading and writing, and the average number of requests in the request-queue of the disk driver.</p><p>Now you can easily see exactly what is happening (if anything) at the system-level disk resource. You can see that something cancelled your write request before it got written to disk. Unfortunately, It won&rsquo;t tell you which line in your program is causing this.
​​​​</p><h3 id=memory-leaks>Memory leaks</h3><p>When developing a program, memory leaks are extremely hard to find. Many programs have had memory leaks through many versions, with developers scratching their heads looking for them. Atop lets you watch memory dynamically, logging all data by time and threads, allowing you to easily spot memory leaks.</p></div><div class=mt-16><script src=https://giscus.app/client.js data-repo=ntk148v/ntk148v.github.io data-repo-id=R_kgDOIWtaXA data-category="Show and tell" data-category-id=DIC_kwDOIWtaXM4CSU-P data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></div></article></div></main><footer class="fixed left-0 bottom-0 w-full bg-base px-page-gutter"><div class="flex justify-center items-center h-footer-height"><div class="flex flex-row w-full max-w-content justify-between lowercase italic gap-3"><nav><ul class="flex text-md space-x-3 sm:space-x-6"><li class=text-text><a href=/contact class="tracking-wide hover:underline">Contact</a></li><li class=text-text><a href=/posts class="tracking-wide hover:underline">Posts</a></li></ul></nav><span class="text-muted hidden md:block">&copy;
2024
<a href=https://github.com/ntk148v/hugo-toigian class="font-bold hover:underline">hugo-toigian</a></span><div id=header-theme-button><svg id="dark_mode_btn" class="hidden toolbox-btn" width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718.0 0118 15.75c-5.385.0-9.75-4.365-9.75-9.75.0-1.33.266-2.597.748-3.752A9.753 9.753.0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753.0 009.002-5.998z"/></svg><svg id="light_mode_btn" class="hidden toolbox-btn" width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75.0 11-7.5.0 3.75 3.75.0 017.5.0z"/></svg></div></div></div></footer></body></html>