<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Author: Kien Nguyen <kiennt2609@gmail.com>
      A minimal Hugo theme with Tailwind CSS"><title>kiennt26's home
| Writing a Simple Shell in C Sharp</title><meta name=author content="map[email:kiennt2609@gmail.com name:Kien Nguyen-Tuan]"><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon_io/favicon.ico type=image/x-icon><link rel=icon href=/favicon_io/favicon-16x16.png size=16x16 type=image/png><link rel=icon href=/favicon_io/favicon-32x32.png size=32x32 type=image/png><link rel=preload type=text/css href=/css/rose-pine.min.css integrity as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet type=text/css href=/css/rose-pine.min.css integrity></noscript><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;500;700&display=swap" rel="preload stylesheet"><link rel=preload type=text/css href="/css/toigian.min.177bcbf4b6788283812da2a58a4225eeb239f79c56e32a659f89d59cef5e9932.css" integrity="sha256-F3vL9LZ4goOBLaKlikIl7rI595xW4ypln4nVnO9emTI=" as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet type=text/css href="/css/toigian.min.177bcbf4b6788283812da2a58a4225eeb239f79c56e32a659f89d59cef5e9932.css" integrity="sha256-F3vL9LZ4goOBLaKlikIl7rI595xW4ypln4nVnO9emTI="></noscript><link rel=stylesheet type=text/css href="/css/light.min.29febe5c26ca625f7e2913e2509889a65637f415171eb003603102dea7cc42e0.css" integrity="sha256-Kf6+XCbKYl9+KRPiUJiJplY39BUXHrADYDEC3qfMQuA="><link rel=stylesheet type=text/css href="/css/dark.min.47fea451289f4f246c4875ba0aa5f6376183f220c766f5e90d15d6e48cb7b937.css" integrity="sha256-R/6kUSifTyRsSHW6CqX2N2GD8iDHZvXpDRXW5Iy3uTc="><script>localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")</script><script async defer src=/js/main.dfa968b06ebe7fb755eb156f7296445f20bd5ca0c82aa2eb755b1bfac4e2f294676471cf7670590073c364901a0dd5dc4b4c7b83f7a4a3c3b081f085c78fa1de.js integrity="sha512-36losG6+f7dV6xVvcpZEXyC9XKDIKqLrdVsb+sTi8pRnZHHPdnBZAHPDZJAaDdXcS0x7g/eko8OwgfCFx4+h3g=="></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script></head><body><header style=--layer:10><div aria-hidden=true class="absolute top-[-1000px] left-0 z-[calc(var(--layer)+1)] h-[calc(1000px+var(--page-top))] w-full bg-base"></div><div class="fixed top-0 left-0 z-[var(--layer)] flex h-header-height w-full items-center border-b px-page-gutter before:absolute before:inset-0 before:z-[-1] before:bg-base [@supports(backdrop-filter:blur(0))]:before:bg-base [@supports(backdrop-filter:blur(0))]:before:backdrop-blur-md"><div class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"><nav><ol class="flex text-md items-center"><li><a href=/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">kiennt26's home</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Posts</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/writing-a-simple-shell-in-c-sharp/ class="focus:underline focus:outline-none font-bold after:md:mx-2 after:mx-0.5">Writing a Simple Shell in C Sharp</a></li></ol></nav><nav><a href=https://ntk148v.github.io/index.xml><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5.0 00-7.5-7.5H4.5m0-6.75h.75c7.87.0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75.0 11-1.5.0.75.75.0 011.5.0z"/></svg></a></nav></div></div></header><main class="flex justify-center px-page-gutter py-page-top"><div class="min-h-content w-full max-w-content space-y-10 sm:space-y-20"><div class="lowercase italic mx-auto flex w-full max-w-content items-center justify-between"><nav><ol class="flex text-md items-center"><li><a href=/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">kiennt26's home</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/ class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">Posts</a></li><li class="text-muted focus:underline focus:outline-none after:md:mx-2 after:mx-0.5">/</li><li><a href=/posts/writing-a-simple-shell-in-c-sharp/ class="focus:underline focus:outline-none font-bold after:md:mx-2 after:mx-0.5">Writing a Simple Shell in C Sharp</a></li></ol></nav><nav><a href=https://ntk148v.github.io/index.xml><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5.0 00-7.5-7.5H4.5m0-6.75h.75c7.87.0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75.0 11-1.5.0.75.75.0 011.5.0z"/></svg></a></nav></div><article><h1>Writing a Simple Shell in C Sharp</h1><time class="text-sm italic tabular-nums text-muted">2023/08/20&nbsp;</time>
<nobr class="text-sm text-muted">&#8674&nbsp;</nobr><time class="text-sm italic tabular-nums text-muted">2023/08/21&nbsp;</time><div class=section><a href=/tags/tech/ id=tag>tech</a>
<a href=/tags/csharp/ id=tag>csharp</a>
<a href=/tags/shell/ id=tag>shell</a></div><div id=toc><details open><summary>Table of contents</summary><div id=toc-list><nav id=TableOfContents><ol><li><a href=#1-what-is-a-shell>1. What is a shell?</a></li><li><a href=#2-basic-lifetime-of-a-shell>2. Basic lifetime of a shell</a></li><li><a href=#3-execute-command>3. Execute command</a></li><li><a href=#4-shell-built-in-commands>4. Shell Built-in Commands</a><ol><li><a href=#41-cd>4.1. <code>cd</code></a></li><li><a href=#42-exit>4.2. <code>exit</code></a></li><li><a href=#43-which>4.3. <code>which</code></a></li><li><a href=#44-help>4.4. <code>help</code></a></li></ol></li><li><a href=#5-improvement>5. Improvement</a><ol><li><a href=#51-handle-exception>5.1. Handle exception</a></li><li><a href=#52-handle-command-not-found>5.2. Handle command not found</a></li></ol></li><li><a href=#6-wrap-up>6. Wrap up</a></li></ol></nav></div></details></div><div class=content><p>In this post, we will write a minimalistic shell for UNIX(-like) operating systems in C# programming language. I create this for learning C# purpose.</p><p>Since its purpose demonstration (not feature completeness or even fitness for causual use), it has many limitations, including:</p><ul><li>Commands must be on a single line.</li><li>Arguments must be separated by whitespace.</li><li>No quoting arguments or escaping whitespace.</li><li>No piping or redirection.</li></ul><blockquote><p>Before we start, make sure you have .NET Core environment and knownledge.</p></blockquote><h2 id=1-what-is-a-shell>1. What is a shell?</h2><p>In computing, a <a href=https://en.wikipedia.org/wiki/Shell_(computing)>shell</a> is a computer program that exposes an operating system&rsquo;s services to a human user or other programs. In general, operating system shells use either a command-line interface (CLI) or graphical user interface (GUI), depending on a computer&rsquo;s role and particular operation. It is named a shell because it is the outermost layer around the operating system.</p><p>Some examples:</p><ul><li>Bash</li><li>Zsh</li><li>Gnome Shell</li></ul><p>In this article, I describe <em>a simple text-based, non-graphical shell</em> with the basic functionality: give an input command and receive the output of this command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Input</span>
</span></span><span class=line><span class=cl>$ ls
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Output</span>
</span></span><span class=line><span class=cl>Documents   Downloads   Desktop
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div><p>That&rsquo;s it!</p><h2 id=2-basic-lifetime-of-a-shell>2. Basic lifetime of a shell</h2><p>Let&rsquo;s look at a shell from the top down. A shell does three main things its lifetime.</p><ul><li><strong>Initialize</strong>: A typical shell would read and execute its configuration files. These change aspects of the shell&rsquo;s behavior. If you&rsquo;re familiar with bash shell, you may know <code>.bashrc</code> file, where you put the custom configuration.</li><li><strong>Interpret</strong>: The shell reads commands from stdin (which could be interactive, or a file) and executes them.</li><li><strong>Terminate</strong>: After its commands are executed, the seehll executes any shutdown commands, fres up and memory, and terminates.</li></ul><p>But in our case, the shell will be simple as possible that there won&rsquo;t be any configuration files, and there won&rsquo;t be any shutdown command. So, we&rsquo;ll just call the input looping function and then terminate.</p><p>The basic structure looks like the following:</p><ul><li>Call our shell as <code>KShell</code></li><li>Print a prefix, just like Bash shell.</li><li>Read the user input from keyboard.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>namespace</span> <span class=nn>KShell</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>KShell</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Test it in Linux only</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=kt>string</span> <span class=n>_currUser</span> <span class=p>=</span> <span class=n>Environment</span><span class=p>.</span><span class=n>UserName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=kt>string</span> <span class=n>_currDir</span> <span class=p>=</span> <span class=n>Directory</span><span class=p>.</span><span class=n>GetCurrentDirectory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=kt>string</span> <span class=n>_hostname</span> <span class=p>=</span> <span class=n>Environment</span><span class=p>.</span><span class=n>MachineName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Load config files, if any.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Run the input loop</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=k>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Console</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=s>$&#34;{_currUser}@{_hostname}:{_currDir}$ &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// Read the keyboard input</span>
</span></span><span class=line><span class=cl>            <span class=kt>string?</span> <span class=n>input</span> <span class=p>=</span> <span class=n>Console</span><span class=p>.</span><span class=n>ReadLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=n>IsNullOrEmpty</span><span class=p>(</span><span class=n>input</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>execCommand</span><span class=p>(</span><span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>void</span> <span class=n>execCommand</span><span class=p>(</span><span class=kt>string</span> <span class=n>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Just print</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=s>$&#34;The input commmand: {input}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Build, run and we have the result, do you feel familiar?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ <span class=nb>cd</span>
</span></span><span class=line><span class=cl>The input commmand: <span class=nb>cd</span>
</span></span></code></pre></div><h2 id=3-execute-command>3. Execute command</h2><p>Now, we want to execute the entered command in <code>execCommand(string input)</code> function.</p><ul><li>First, remove the trailing blank spaces of the input, then parse the input separate the command and the arguments.</li><li>Prepare the command.</li><li>Clear the standard output, this is a trick to remove the prefix (we created before) from the output.</li><li>Execute the command.<ul><li>Starting processes is the main function of shells.</li><li>C# and .NET takes care all the difficult stuffs for us, but I recommend you to read about how shells start processes on Unix-like operating systems.<ul><li>There are only two ways of starting processes on Unix. The first one (almost doesn&rsquo;t count) is by being <code>Init</code>. You see, when a Unix computer boots, its kernel is loaded. Once it is loaded and initialized, the kernel starts only one process, which is called Init. This process runs for the entire length of time that the computer is on, and it manages loading up the rest of the processes that you need for your computer to be useful.</li><li>Since most program aren&rsquo;t <code>Init</code>, that leaves only one practical way for processes to get started: the <code>fork()</code> system call. When this function is called, the operating system makes a duplicate of the process and starts them both running. The original process is called the &ldquo;parent&rdquo;, and the new one is called the &ldquo;child&rdquo;. <code>fork()</code> returns 0 to the child process, and it returns to the parent the process ID number (PID) of its child. In essence, this means that the only way for new processes is to start is by an existing one duplicating itself.</li><li>Typically, when you want to run a new process, you don&rsquo;t just want another copy of the same program - you want to run a different program. That&rsquo;s what the <code>exec()</code> system call is all about.</li><li>With the two system calls, we have the building blocks for how most program are run on Unix. First, an existing process forks itself into two separate ones. Then, the child uses <code>exec()</code> to replace itself with a new program. The parent process can continue doing other things, and it can even keep tabs on its children, using the system call <code>wait()</code>.</li></ul></li></ul></li></ul><figure class=figure><img src=http://www.it.uu.se/education/course/homepage/os/vt18/images/module-2/fork-exec-exit-wait.png alt="From it.uu.se: Operating systems"><figcaption><p>From it.uu.se: Operating systems</p></figcaption></figure><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>static</span> <span class=k>void</span> <span class=n>execCommand</span><span class=p>(</span><span class=kt>string</span> <span class=n>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Split the input separate the command and the arguments</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span><span class=p>[]</span> <span class=n>args</span> <span class=p>=</span> <span class=n>input</span><span class=p>.</span><span class=n>TrimEnd</span><span class=p>().</span><span class=n>Split</span><span class=p>(</span><span class=s>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Execute command</span>
</span></span><span class=line><span class=cl>    <span class=n>ProcessStartInfo</span> <span class=n>startInfo</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ProcessStartInfo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>FileName</span> <span class=p>=</span> <span class=n>args</span><span class=p>[</span><span class=m>0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>Arguments</span> <span class=p>=</span> <span class=kt>string</span><span class=p>.</span><span class=n>Join</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>,</span> <span class=n>args</span><span class=p>.</span><span class=n>Skip</span><span class=p>(</span><span class=m>1</span><span class=p>).</span><span class=n>ToArray</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>        <span class=n>RedirectStandardOutput</span> <span class=p>=</span> <span class=k>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>RedirectStandardError</span> <span class=p>=</span> <span class=k>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Process</span> <span class=n>proc</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Process</span><span class=p>()</span> <span class=p>{</span> <span class=n>StartInfo</span> <span class=p>=</span> <span class=n>startInfo</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Clear the standard output</span>
</span></span><span class=line><span class=cl>    <span class=c1>// NOTE(kiennt26): This is a trick to remove the prefix from the command output</span>
</span></span><span class=line><span class=cl>    <span class=n>proc</span><span class=p>.</span><span class=n>OutputDataReceived</span> <span class=p>+=</span> <span class=p>(</span><span class=n>sender</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>Data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>proc</span><span class=p>.</span><span class=n>Start</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>proc</span><span class=p>.</span><span class=n>BeginOutputReadLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>proc</span><span class=p>.</span><span class=n>WaitForExit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Build and run the shell, enter your desired command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ ls
</span></span><span class=line><span class=cl>KShell
</span></span><span class=line><span class=cl>KShell.deps.json
</span></span><span class=line><span class=cl>KShell.dll
</span></span><span class=line><span class=cl>KShell.pdb
</span></span><span class=line><span class=cl>KShell.runtimeconfig.json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ ls -la
</span></span><span class=line><span class=cl>total <span class=m>176</span>
</span></span><span class=line><span class=cl>drwxrwxr-x <span class=m>2</span> kiennt kiennt   <span class=m>4096</span> Thg <span class=m>8</span>  <span class=m>21</span> 14:33 .
</span></span><span class=line><span class=cl>drwxrwxr-x <span class=m>3</span> kiennt kiennt   <span class=m>4096</span> Thg <span class=m>8</span>  <span class=m>21</span> 14:28 ..
</span></span><span class=line><span class=cl>-rwxr-xr-x <span class=m>1</span> kiennt kiennt <span class=m>142840</span> Thg <span class=m>8</span>  <span class=m>21</span> 14:52 KShell
</span></span><span class=line><span class=cl>-rw-rw-r-- <span class=m>1</span> kiennt kiennt    <span class=m>388</span> Thg <span class=m>8</span>  <span class=m>21</span> 14:33 KShell.deps.json
</span></span><span class=line><span class=cl>-rw-rw-r-- <span class=m>1</span> kiennt kiennt   <span class=m>6656</span> Thg <span class=m>8</span>  <span class=m>21</span> 14:52 KShell.dll
</span></span><span class=line><span class=cl>-rw-rw-r-- <span class=m>1</span> kiennt kiennt  <span class=m>10676</span> Thg <span class=m>8</span>  <span class=m>21</span> 14:52 KShell.pdb
</span></span><span class=line><span class=cl>-rw-rw-r-- <span class=m>1</span> kiennt kiennt    <span class=m>139</span> Thg <span class=m>8</span>  <span class=m>21</span> 14:33 KShell.runtimeconfig.json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ <span class=nb>pwd</span>
</span></span><span class=line><span class=cl>/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0
</span></span></code></pre></div><p>It works nicely! It&rsquo;s starting to look like a real shell! But hold on, enter the super casual command - <code>cd</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ <span class=nb>cd</span>
</span></span><span class=line><span class=cl>Unhandled exception. System.ComponentModel.Win32Exception <span class=o>(</span>2<span class=o>)</span>: An error occurred trying to start process <span class=s1>&#39;cd&#39;</span> with working directory <span class=s1>&#39;/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0&#39;</span>. No such file or directory
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div><p>Huh, something went wrong here. Why does the <code>cd</code> command not work? <code>cd</code> is not <a href=https://stackoverflow.com/a/38776411>real</a> command, the functionality is a built-in command of the shell.</p><h2 id=4-shell-built-in-commands>4. Shell Built-in Commands</h2><p>Now, we will create some built-in commands. We have to modify the <code>execCommand</code> function: add a <code>switch</code> statement to the first argument (the command to execute) which is stored in <code>args[0]</code>.</p><h3 id=41-cd>4.1. <code>cd</code></h3><p>First, implement <code>cd</code>:</p><ul><li>If user enters <code>cd ~</code> or <code>cd</code> without arguments, the working directory is home.</li><li>Change the working directory to the input.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>static</span> <span class=k>void</span> <span class=n>execCommand</span><span class=p>(</span><span class=kt>string</span> <span class=n>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Split the input separate the command and the arguments</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span><span class=p>[]</span> <span class=n>args</span> <span class=p>=</span> <span class=n>input</span><span class=p>.</span><span class=n>TrimEnd</span><span class=p>().</span><span class=n>Split</span><span class=p>(</span><span class=s>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Check for the built-in shell commands</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=m>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s>&#34;cd&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>builtInCD</span><span class=p>(</span><span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s>&#34;#&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Handle the comment case</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Execute command</span>
</span></span><span class=line><span class=cl>                <span class=c1>// ...</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Built-in cd - Change the shell working directory.</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Change the current directory to DIR. The default DIR is the value of the</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// HOME shell variable.</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// cd [dir]</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;args&#34;&gt;&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>void</span> <span class=n>builtInCD</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>newWorkingDir</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>args</span><span class=p>.</span><span class=n>Length</span> <span class=p>&lt;</span> <span class=m>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// cd to home with empty path</span>
</span></span><span class=line><span class=cl>            <span class=n>newWorkingDir</span> <span class=p>=</span> <span class=n>Environment</span><span class=p>.</span><span class=n>GetFolderPath</span><span class=p>(</span><span class=n>Environment</span><span class=p>.</span><span class=n>SpecialFolder</span><span class=p>.</span><span class=n>UserProfile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=m>1</span><span class=p>]</span> <span class=p>==</span> <span class=s>&#34;~&#34;</span><span class=p>)</span> <span class=c1>// handle a special character</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>newWorkingDir</span> <span class=p>=</span> <span class=n>Environment</span><span class=p>.</span><span class=n>GetFolderPath</span><span class=p>(</span><span class=n>Environment</span><span class=p>.</span><span class=n>SpecialFolder</span><span class=p>.</span><span class=n>UserProfile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>newWorkingDir</span> <span class=p>=</span> <span class=n>args</span><span class=p>[</span><span class=m>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Change the directory</span>
</span></span><span class=line><span class=cl>        <span class=n>Directory</span><span class=p>.</span><span class=n>SetCurrentDirectory</span><span class=p>(</span><span class=n>newWorkingDir</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>_currDir</span> <span class=p>=</span> <span class=n>Directory</span><span class=p>.</span><span class=n>GetCurrentDirectory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h3 id=42-exit>4.2. <code>exit</code></h3><p>Similiarly, implement the <code>exit</code> command, it&rsquo;s quite simple.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// ...</span>
</span></span><span class=line><span class=cl>    <span class=c1>// execCommand</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s>&#34;exit&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>builtInExit</span><span class=p>(</span><span class=m>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Built-in exit - Exit the shell with a status of n. If n is omitted,</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// the exit status is that of the last command executed.</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// exit [n]</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;exitCode&#34;&gt;&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>void</span> <span class=n>builtInExit</span><span class=p>(</span><span class=kt>int</span> <span class=n>exitCode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO(kiennt26): Handle the given exit code, it should be in range 0-255</span>
</span></span><span class=line><span class=cl>        <span class=n>Environment</span><span class=p>.</span><span class=n>Exit</span><span class=p>(</span><span class=n>exitCode</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h3 id=43-which>4.3. <code>which</code></h3><p><code>which</code> returns the pathnames of the files (or links) which would be executed in the current environment. It does this by searching the PATH for executable files matching the file names of the arguments.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=c1>// Get the PATH environment variable for a list of directories.</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=kt>string</span><span class=p>[]</span> <span class=n>_path</span> <span class=p>=</span> <span class=n>Environment</span><span class=p>.</span><span class=n>GetEnvironmentVariable</span><span class=p>(</span><span class=s>&#34;PATH&#34;</span><span class=p>).</span><span class=n>Split</span><span class=p>(</span><span class=s>&#34;:&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>Create a function that searches the PATH for executable files matching the file names of the arguments.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>static</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>searchInPath</span><span class=p>(</span><span class=kt>string</span> <span class=n>executable</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>List</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;</span> <span class=n>pathNames</span> <span class=p>=</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// string[] pathNames = new string[0];</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>p</span> <span class=k>in</span> <span class=n>_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>pathNames</span><span class=p>.</span><span class=n>AddRange</span><span class=p>(</span><span class=n>Directory</span><span class=p>.</span><span class=n>GetFiles</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>executable</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pathNames</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>Then, create <code>builtInWhich</code> function to print out the result. If there is no matching executable file, returns nothing.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// execCommand</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s>&#34;which&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>builtInWhich</span><span class=p>(</span><span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// Built-in which - locate a command</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// which returns the pathnames of the files (or links) which would be executed in the current environment.</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// It does this by searching the PATH for executable files matching the file names of the arguments.</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>    <span class=cs>/// &lt;param name=&#34;args&#34;&gt;&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>void</span> <span class=n>builtInWhich</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>args</span><span class=p>.</span><span class=n>Length</span> <span class=p>&lt;</span> <span class=m>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>executable</span> <span class=k>in</span> <span class=n>args</span><span class=p>.</span><span class=n>Skip</span><span class=p>(</span><span class=m>1</span><span class=p>).</span><span class=n>ToArray</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span> <span class=p>(</span><span class=kt>string</span> <span class=n>p</span> <span class=k>in</span> <span class=n>searchInPath</span><span class=p>(</span><span class=n>executable</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ which ls
</span></span><span class=line><span class=cl>/usr/bin/ls
</span></span><span class=line><span class=cl>/bin/ls
</span></span><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ which <span class=nb>pwd</span>
</span></span><span class=line><span class=cl>/usr/bin/pwd
</span></span><span class=line><span class=cl>/bin/pwd
</span></span><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ which cat grep
</span></span><span class=line><span class=cl>/usr/bin/cat
</span></span><span class=line><span class=cl>/bin/cat
</span></span><span class=line><span class=cl>/usr/bin/grep
</span></span><span class=line><span class=cl>/bin/grep
</span></span><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$
</span></span></code></pre></div><h3 id=44-help>4.4. <code>help</code></h3><p>A help page always necessary, let&rsquo;s create one. Logic is simple:</p><ul><li>If user enter <code>help</code> command alone, returns a general help.</li><li>If user enter <code>help &lt;built-in></code>, returns the command specified help.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// execCommand</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s>&#34;help&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>builtInHelp</span><span class=p>(</span><span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=k>void</span> <span class=n>builtInHelp</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>help</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>args</span><span class=p>.</span><span class=n>Length</span> <span class=p>&lt;</span> <span class=m>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>help</span> <span class=p>=</span> <span class=s>@&#34;
</span></span></span><span class=line><span class=cl><span class=s>KShell aka. Kien&#39;s Shell, written in C#.
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    Type program names and arguments, and hit &lt;enter&gt;.
</span></span></span><span class=line><span class=cl><span class=s>    These shell commands are defined internally.  Type `help` to see this list.
</span></span></span><span class=line><span class=cl><span class=s>    Type `help name` to find out more about the function `name&#39;.
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    cd [dir]
</span></span></span><span class=line><span class=cl><span class=s>    exit [n]
</span></span></span><span class=line><span class=cl><span class=s>    which filename ...
</span></span></span><span class=line><span class=cl><span class=s>    help&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>switch</span> <span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=m>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=s>&#34;cd&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>help</span> <span class=p>=</span> <span class=s>@&#34;
</span></span></span><span class=line><span class=cl><span class=s>cd: cd [dir]
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    Change the shell working directory.
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    Change the current directory to &#39;dir&#39;. The default &#39;dir&#39; is the value of the user&#39;s home directory.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=s>&#34;exit&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>help</span> <span class=p>=</span> <span class=s>@&#34;
</span></span></span><span class=line><span class=cl><span class=s>exit: exit [n]
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    Exit the shell.
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    Exits the shell with a status of &#39;n&#39;.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=s>&#34;which&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>help</span> <span class=p>=</span> <span class=s>@&#34;
</span></span></span><span class=line><span class=cl><span class=s>which: which filename ...
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    Locate a command.
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    which returns the pathnames of the files (or links) which would be executed in the current environment.
</span></span></span><span class=line><span class=cl><span class=s>    It does this by searching the PATH for executable files matching the names of the arguments.
</span></span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>help</span> <span class=p>=</span> <span class=s>@&#34;
</span></span></span><span class=line><span class=cl><span class=s>KShell aka. Kien&#39;s Shell, written in C#.
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    Type program names and arguments, and hit &lt;enter&gt;.
</span></span></span><span class=line><span class=cl><span class=s>    These shell commands are defined internally.  Type `help` to see this list.
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    cd [dir]
</span></span></span><span class=line><span class=cl><span class=s>    exit [n]
</span></span></span><span class=line><span class=cl><span class=s>    help&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>help</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ <span class=nb>help</span> <span class=nb>cd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cd: <span class=nb>cd</span> <span class=o>[</span>dir<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Change the shell working directory.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Change the current directory to <span class=s1>&#39;dir&#39;</span>. The default <span class=s1>&#39;dir&#39;</span> is the value of the user<span class=err>&#39;</span>s home directory.
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ <span class=nb>help</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>KShell aka. Kien<span class=s1>&#39;s Shell, written in C#.
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>    Type program names and arguments, and hit &lt;enter&gt;.
</span></span></span><span class=line><span class=cl><span class=s1>    These shell commands are defined internally.  Type `help` to see this list.
</span></span></span><span class=line><span class=cl><span class=s1>    Type `help name` to find out more about the function `name&#39;</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>cd</span> <span class=o>[</span>dir<span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=o>[</span>n<span class=o>]</span>
</span></span><span class=line><span class=cl>    which filename ...
</span></span><span class=line><span class=cl>    <span class=nb>help</span>
</span></span></code></pre></div><h2 id=5-improvement>5. Improvement</h2><h3 id=51-handle-exception>5.1. Handle exception</h3><p>Entering the wrong command, and a long stacktrace returns. It makes nonsense for the end user. The end user just need a message like: &ldquo;command not found&rdquo;. Just it.</p><p>We will wrap the main input loop in try/catch.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=k>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Load config files, if any.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Run the input loop</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=k>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>Console</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=s>$&#34;{_currUser}@{_hostname}:{_currDir}$ &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// Read the keyboard input</span>
</span></span><span class=line><span class=cl>                <span class=kt>string?</span> <span class=n>input</span> <span class=p>=</span> <span class=n>Console</span><span class=p>.</span><span class=n>ReadLine</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=n>IsNullOrEmpty</span><span class=p>(</span><span class=n>input</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>execCommand</span><span class=p>(</span><span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>Message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 0 - Success</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 1 - Fail</span>
</span></span><span class=line><span class=cl>                <span class=n>builtInExit</span><span class=p>(</span><span class=m>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>Looks much better now:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ wrongcommand
</span></span><span class=line><span class=cl>An error occurred trying to start process <span class=s1>&#39;wrongcommand&#39;</span> with working directory <span class=s1>&#39;/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0&#39;</span>. No such file or directory
</span></span></code></pre></div><h3 id=52-handle-command-not-found>5.2. Handle command not found</h3><p>The exception&rsquo;s message is still not clear enough for the end user. We can check if the command is existing before execute it. Remember <code>search3</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>    <span class=c1>// execCommand</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Check if args[0] is an executable file</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>searchInPath</span><span class=p>(</span><span class=n>args</span><span class=p>[</span><span class=m>0</span><span class=p>]).</span><span class=n>Count</span> <span class=p>&lt;</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>throw</span> <span class=k>new</span> <span class=n>Exception</span><span class=p>(</span><span class=s>$&#34;{args[0]}: command not found&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// ...</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kiennt@kiennt-ROG-Strix-G513IH-G513IH:/home/kiennt/Workspace/github.com/ntk148v/Solution1/KShell/bin/Debug/net6.0$ wrongcommand
</span></span><span class=line><span class=cl>wrongcommand: <span class=nb>command</span> not found
</span></span></code></pre></div><h2 id=6-wrap-up>6. Wrap up</h2><p>I hope you enjoyed it. I think, when you understand the concepts behind it, it&rsquo;s quite simple (especially with high-level programming language like C#).</p><p>Feel free to extend the shell with new features.</p><p>This post is highly inspired by:</p><ul><li><a href=https://simjue.pages.dev/post/2018/07-01-go-unix-shell/>Writing a simple shell in Go</a></li><li><a href=https://brennan.io/2015/01/16/write-a-shell-in-c/>Write a shell in C</a></li></ul><p>The code for <code>KShell</code> is available on <a href=https://github.com/ntk148v/KShell/tree/master>Github</a>.</p></div><div class=mt-16><script src=https://giscus.app/client.js data-repo=ntk148v/ntk148v.github.io data-repo-id=R_kgDOIWtaXA data-category="Show and tell" data-category-id=DIC_kwDOIWtaXM4CSU-P data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></div></article></div></main><footer class="fixed left-0 bottom-0 w-full bg-base px-page-gutter"><div class="flex justify-center items-center h-footer-height"><div class="flex flex-row w-full max-w-content justify-between lowercase italic gap-3"><nav><ul class="flex text-md space-x-3 sm:space-x-6"><li class=text-text><a href=/contact class="tracking-wide hover:underline">Contact</a></li><li class=text-text><a href=/posts class="tracking-wide hover:underline">Posts</a></li></ul></nav><span class="text-muted hidden md:block">&copy;
2023
<a href=https://github.com/ntk148v/hugo-toigian class="font-bold hover:underline">hugo-toigian</a></span><div id=header-theme-button><svg id="dark_mode_btn" class="hidden toolbox-btn" width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718.0 0118 15.75c-5.385.0-9.75-4.365-9.75-9.75.0-1.33.266-2.597.748-3.752A9.753 9.753.0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753.0 009.002-5.998z"/></svg><svg id="light_mode_btn" class="hidden toolbox-btn" width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75.0 11-7.5.0 3.75 3.75.0 017.5.0z"/></svg></div></div></div></footer></body></html>